import{r as u,j as e,_ as le,$ as K,a0 as oe,a1 as ce,a2 as S,n as J,a3 as de,a4 as G,a5 as me,a6 as F,z as v,m as ue,s as fe,b as he,a7 as _,a8 as Q,a9 as Y,aa as B,C as xe,P as R,ab as pe,ac as N,ad as P,ae as ge,T as be,S as ve,y as q}from"./index-n-tMNa-I.js";import{u as ye}from"./use-auth-Cjyk4KIV.js";import{C as Ne}from"./camera-BDYUYBzu.js";import{C as je}from"./circle-alert-CAufM4CJ.js";import{C as we}from"./crown-kLCl4oPx.js";var Se="Separator",H="horizontal",Fe=["horizontal","vertical"],W=u.forwardRef((r,c)=>{const{decorative:d,orientation:m=H,...f}=r,t=Pe(m)?m:H,h=d?{role:"none"}:{"aria-orientation":t==="vertical"?t:void 0,role:"separator"};return e.jsx(le.div,{"data-orientation":t,...h,...f,ref:c})});W.displayName=Se;function Pe(r){return Fe.includes(r)}var Ce=W;function Ue({className:r,orientation:c="horizontal",decorative:d=!0,...m}){return e.jsx(Ce,{"data-slot":"separator-root",decorative:d,orientation:c,className:K("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",r),...m})}const Ee=ce("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function C({className:r,variant:c,asChild:d=!1,...m}){const f=d?oe:"span";return e.jsx(f,{"data-slot":"badge",className:K(Ee({variant:c}),r),...m})}const L={get:{getAll:async()=>(await S.get("/users")).data,getProfile:async()=>(await S.get("/users/profile")).data,getPremium:async()=>(await S.get("/users/premium-status")).data},put:{updateProfile:async r=>(await S.put("/users/profile",r,{headers:{"Content-Type":"multipart/form-data"}})).data}},X=()=>{const{toast:r}=J(),c=new de,d=G({queryKey:[F.GET_PREMIUM_STATUS],queryFn:async()=>await L.get.getPremium()}),m=G({queryKey:[F.USER.GET_USER_PROFILE],queryFn:async()=>await L.get.getProfile()}),f=me({mutationKey:[F.USER.UPDATE_PROFILE],mutationFn:async t=>await L.put.updateProfile(t),onSuccess:async t=>{r({title:"Update successfully",description:(t==null?void 0:t.message)||"Profile updated successfully",variant:"success"})},onError:async t=>{var i,h,l,p;r({title:"Update failed",description:((p=(l=(h=(i=t==null?void 0:t.response)==null?void 0:i.data)==null?void 0:h.errors)==null?void 0:l[0])==null?void 0:p.message)||(t==null?void 0:t.message)||"Failed to update profile",variant:"destructive"})},onSettled:()=>{c.invalidateQueries({queryKey:[F.USER.GET_USER_PROFILE]})}});return{getPremiumStatusQuery:d,getUserProfileQuery:m,updateUserProfile:f}},Ae=v.instanceof(File).optional(),De=v.object({fullName:v.string().min(2,"Full name must be at least 2 characters long").max(100,"Full name cannot exceed 100 characters").regex(/^[\p{L}\s]+$/u,"Full name can only contain letters and spaces").trim().optional(),phoneNumber:v.string().regex(/^[+]?[\d\s\-()]+$/,"Phone number format is invalid").min(10,"Phone number must be at least 10 digits").max(10,"Phone number must be at least 10 digits").optional(),gender:v.number().int("Gender must be an integer").min(0,"Gender must be 0, 1, or 2").max(2,"Gender must be 0, 1, or 2").optional(),avatarUrl:Ae,birthday:v.string().regex(/^\d{4}-\d{2}-\d{2}$/,"Birthday must be in YYYY-MM-DD format").refine(r=>new Date(r)<=new Date,"Birthday cannot be in the future").optional()}).refine(r=>Object.keys(r).length>0,"At least one field must be provided for update"),Re=()=>{const{updateUserProfile:r}=X();return{updateUserProfileForm:(d={})=>({form:ue({resolver:fe(De),defaultValues:{fullName:"",phoneNumber:"",gender:0,avatarUrl:null,birthday:"",...d}}),onSubmit:async t=>{try{console.log("ðŸ” useUserForm onSubmit received data:",t),console.log("ðŸ” Avatar file check:",t.avatarUrl instanceof File?"âœ… Is File":"âŒ Not a File",t.avatarUrl);let i;if(t.avatarUrl&&t.avatarUrl instanceof File){i=new FormData,i.append("FullName",t.fullName||""),i.append("PhoneNumber",t.phoneNumber||""),i.append("Gender",t.gender.toString()),i.append("Birthday",t.birthday||""),i.append("AvatarUrl",t.avatarUrl),console.log("ðŸ“¤ Creating FormData with file:"),console.log("ðŸ“¤ File name:",t.avatarUrl.name),console.log("ðŸ“¤ File size:",t.avatarUrl.size),console.log("ðŸ“¤ File type:",t.avatarUrl.type);for(let[h,l]of i.entries())console.log(`ðŸ“¤ FormData - ${h}:`,l instanceof File?`[File: ${l.name}, ${l.size} bytes]`:l)}else i={fullName:t.fullName||"",phoneNumber:t.phoneNumber||"",gender:t.gender,birthday:t.birthday||""},console.log("ðŸ“¤ Creating JSON object:",i);console.log("ðŸ“¤ Final submitData type:",i instanceof FormData?"FormData":"JSON Object"),await r.mutateAsync(i)}catch(i){throw console.error("ðŸš¨ User profile update failed:",i),i}},isLoading:r.isPending,error:r.error})}};function Le(){var V,$;const{user:r}=he(),{toast:c}=J(),d=u.useRef(null),{useSendVerifyEmail:m}=ye(),{getPremiumStatusQuery:f,getUserProfileQuery:t}=X(),{updateUserProfileForm:i}=Re(),h=m(),[l,p]=u.useState(null),[g,U]=u.useState(null),[O,z]=u.useState(!1),[j,I]=u.useState(!1),[E,w]=u.useState(!1),[b,Z]=u.useState({}),{data:y,isLoading:A,refetch:D}=t,a=(y==null?void 0:y.data)||r,{form:o,onSubmit:ee,isLoading:T}=i({fullName:"",phoneNumber:"",gender:0,avatarUrl:null,birthday:""});u.useEffect(()=>{!y&&!A&&D()},[y,A,D]),u.useEffect(()=>{if(a&&!j){const s={fullName:(a==null?void 0:a.fullName)||"",phoneNumber:(a==null?void 0:a.phoneNumber)||"",gender:(a==null?void 0:a.gender)||0,birthday:a!=null&&a.birthday?new Date(a.birthday).toISOString().slice(0,10):""};o.reset(s),Z(s),I(!0),w(!1)}},[a,o,j]);const k=o.watch();u.useEffect(()=>{if(j&&b){const s=Object.keys(b).some(x=>x==="avatarUrl"?!1:k[x]!==b[x]);w(s||g!==null)}},[k,b,j,g]);const ae=s=>{const n=s.target.files[0];if(n){if(console.log("ðŸ–¼ï¸ Avatar file selected:",{name:n.name,size:n.size,type:n.type,lastModified:n.lastModified}),!n.type.startsWith("image/")){c({title:"Invalid file type",description:"Please select an image file.",variant:"destructive"});return}if(n.size>5*1024*1024){c({title:"File too large",description:"Please select an image smaller than 5MB.",variant:"destructive"});return}l&&URL.revokeObjectURL(l);const x=URL.createObjectURL(n);p(x),U(n),console.log("ðŸ–¼ï¸ Avatar preview and file state updated")}},te=()=>{var s;(s=d.current)==null||s.click()},se=async s=>{try{const n={fullName:s.fullName||"",phoneNumber:s.phoneNumber||"",gender:s.gender,birthday:s.birthday||"",avatarUrl:g};console.log("Submitting data:"),console.log("fullName:",n.fullName),console.log("phoneNumber:",n.phoneNumber),console.log("gender:",n.gender),console.log("birthday:",n.birthday),console.log("avatarUrl:",g?`[File: ${g.name}, size: ${g.size}]`:"null"),await ee(n),p(null),U(null),w(!1),l&&URL.revokeObjectURL(l),await D(),I(!1),c({title:"Profile updated",description:"Your profile has been updated successfully.",variant:"success"})}catch(n){console.error("Form submission error:",n),c({title:"Update failed",description:"Failed to update profile. Please try again.",variant:"destructive"})}},re=()=>{b&&(o.reset(b),l&&URL.revokeObjectURL(l),p(null),U(null),w(!1),d.current&&(d.current.value=""))},ie=async()=>{z(!0);try{const s=await h.refetch();c({title:"Verification email sent",description:s.data.data,variant:"success"})}catch(s){c({title:"Failed to send verification email",description:s.message||"Something went wrong. Please try again.",variant:"destructive"})}finally{z(!1)}},M=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),ne=()=>{var x;const s=(x=f.data)==null?void 0:x.data;return f.isLoading?e.jsx("div",{className:"w-full mb-4",children:e.jsxs("div",{className:"bg-gray-100 rounded-lg p-3 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded mb-2"}),e.jsx("div",{className:"h-3 bg-gray-300 rounded"})]})}):!s||(a==null?void 0:a.premium)==="FreeTier"?e.jsx("div",{className:"w-full mb-4",children:e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Free Tier"})]}),e.jsx(C,{variant:"secondary",className:"bg-gray-100 text-gray-600 text-xs",children:"Current Plan"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Basic access to courses and features"})]})}):e.jsx("div",{className:"w-full mb-4",children:e.jsxs("div",{className:"bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(we,{className:"w-4 h-4 text-amber-500"}),e.jsx("span",{className:"text-sm font-medium text-amber-800",children:"Premium Member"})]}),e.jsxs(C,{className:"bg-amber-500 text-white text-xs",children:[e.jsx(ve,{className:"w-3 h-3 mr-1"}),s.status]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-amber-700",children:[e.jsx(q,{className:"w-3 h-3"}),e.jsxs("span",{children:["Subscribed: ",M(s.subcriptionAt)]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-amber-700",children:[e.jsx(q,{className:"w-3 h-3"}),e.jsxs("span",{children:["Valid until: ",M(s.endDate)]})]})]}),e.jsx("p",{className:"text-xs text-amber-600 mt-2",children:"Full access to all courses and exclusive content"}),new Date(s.endDate)-new Date<7*24*60*60*1e3&&e.jsx("div",{className:"mt-2 p-2 bg-orange-100 border border-orange-200 rounded text-xs text-orange-700",children:"âš ï¸ Your premium subscription expires soon!"})]})})};return A&&!a?e.jsx("div",{className:"container mx-auto max-w-2xl py-10 px-4",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-300 rounded mb-6"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-7",children:[e.jsx("div",{className:"w-full md:w-1/3 h-96 bg-gray-300 rounded"}),e.jsx("div",{className:"w-full md:w-2/3 h-96 bg-gray-300 rounded"})]})]})}):e.jsxs("div",{className:"container mx-auto max-w-2xl py-10 px-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-primary-yellow mb-6",children:"My Profile"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-7",children:[e.jsxs(_,{className:"w-full md:w-1/3",children:[e.jsx(Q,{children:e.jsx(Y,{children:"Profile Photo"})}),e.jsxs(B,{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative w-32 h-32 rounded-full overflow-hidden bg-amber-50 mb-4 cursor-pointer group",onClick:te,children:[l||a!=null&&a.avatarUrl?e.jsx("img",{src:l||a.avatarUrl,alt:"Profile",className:"w-full h-full object-cover group-hover:opacity-75 transition-opacity"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-amber-100 text-amber-800 text-2xl font-bold group-hover:bg-amber-200 transition-colors",children:(($=(V=a==null?void 0:a.fullName)==null?void 0:V.charAt(0))==null?void 0:$.toUpperCase())||"U"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center hover:bg-[#1b1919b9] bg-opacity-90 group-hover:bg-opacity-50 transition-all duration-200",children:e.jsx(Ne,{className:"text-white opacity-0 group-hover:opacity-100 transition-opacity",size:24})})]}),l&&e.jsx("p",{className:"text-xs text-amber-600 mb-2",children:"New image selected - Save changes to update"}),e.jsx("input",{ref:d,type:"file",accept:"image/*",onChange:ae,className:"hidden"}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"font-medium text-lg",children:a==null?void 0:a.fullName}),e.jsx("p",{className:"text-gray-600",children:a==null?void 0:a.email})]}),ne(),e.jsx("div",{className:"w-full text-center",children:(a==null?void 0:a.status)===0?e.jsxs(C,{className:"bg-green-600",children:[e.jsx(xe,{size:14,className:"mr-1"}),"Verified"]}):e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsxs(C,{className:"bg-primary-yellow",children:[e.jsx(je,{size:14,className:"mr-1"}),"Verification Required"]}),e.jsx(R,{variant:"link",size:"sm",onClick:ie,className:"text-primary-blue hover:text-primary-yellow p-0 h-auto",disabled:O,children:O?"Sending...":"Send verification email"})]})})]})]}),e.jsxs(_,{className:"w-full md:w-2/3",children:[e.jsxs(Q,{children:[e.jsx(Y,{children:"Personal Information"}),e.jsx(pe,{children:"Update your personal information and how others see you on the platform."})]}),e.jsxs("form",{onSubmit:o.handleSubmit(se),children:[e.jsx(B,{className:"space-y-4 gap-2 px-4 py-6",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"fullName",children:"Full Name"}),e.jsx(P,{id:"fullName",placeholder:"Your name",...o.register("fullName")}),o.formState.errors.fullName&&e.jsx("p",{className:"text-red-500 text-xs",children:o.formState.errors.fullName.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"phoneNumber",children:"Phone Number"}),e.jsx(P,{id:"phoneNumber",placeholder:"Your phone number",...o.register("phoneNumber")}),o.formState.errors.phoneNumber&&e.jsx("p",{className:"text-red-500 text-xs",children:o.formState.errors.phoneNumber.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"email",children:"Email Address"}),e.jsx(P,{id:"email",type:"email",placeholder:"Your email",value:(a==null?void 0:a.email)||"",disabled:!0}),e.jsx("p",{className:"text-xs text-gray-500",children:"Email address cannot be changed."})]}),e.jsx(Ue,{className:"my-2"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"gender",children:"Gender"}),e.jsxs("select",{id:"gender",...o.register("gender",{valueAsNumber:!0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:0,children:"Male"}),e.jsx("option",{value:1,children:"Female"}),e.jsx("option",{value:2,children:"Other"})]}),o.formState.errors.gender&&e.jsx("p",{className:"text-red-500 text-xs",children:o.formState.errors.gender.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"birthday",children:"Birthday"}),e.jsx(P,{id:"birthday",type:"date",...o.register("birthday")}),o.formState.errors.birthday&&e.jsx("p",{className:"text-red-500 text-xs",children:o.formState.errors.birthday.message})]})]})}),e.jsxs(ge,{className:"flex justify-end space-x-2 gap-2",children:[e.jsx(R,{type:"button",variant:"outline",onClick:re,disabled:!E,children:"Cancel"}),e.jsx(R,{type:"submit",disabled:T||!E,className:`${be.HIGHLIGHT_FRAME} rounded-md cursor-pointer ${E?"":"opacity-50 cursor-not-allowed"}`,children:T?"Saving...":"Save changes"})]})]})]})]})]})}function Me(){return e.jsx(Le,{})}export{Me as default};
