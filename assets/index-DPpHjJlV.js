import{r as u,j as e,_ as de,$,a0 as ce,a1 as me,a2 as P,n as K,a3 as ue,a4 as V,a5 as xe,a6 as S,z as b,m as he,s as fe,a7 as pe,a8 as ge,P as N,T as J,b as be,a9 as U,aa as _,ab as Q,ac as Y,C as ye,ad as ve,ae as v,af as F,ag as Ne,S as je,y as q}from"./index-BXTU0Kr1.js";import{u as we}from"./use-auth-DkjtbbUl.js";import{C as W}from"./camera-C1iGxf4m.js";import{C as Pe}from"./circle-alert-BgtHXBPt.js";import{C as Se}from"./crown-CBLfch1k.js";var Fe="Separator",H="horizontal",Ce=["horizontal","vertical"],X=u.forwardRef((t,d)=>{const{decorative:l,orientation:o=H,...c}=t,s=Ae(o)?o:H,x=l?{role:"none"}:{"aria-orientation":s==="vertical"?s:void 0,role:"separator"};return e.jsx(de.div,{"data-orientation":s,...x,...c,ref:d})});X.displayName=Fe;function Ae(t){return Ce.includes(t)}var Ee=X;function Ge({className:t,orientation:d="horizontal",decorative:l=!0,...o}){return e.jsx(Ee,{"data-slot":"separator-root",decorative:l,orientation:d,className:$("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",t),...o})}const Ie=me("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function C({className:t,variant:d,asChild:l=!1,...o}){const c=l?ce:"span";return e.jsx(c,{"data-slot":"badge",className:$(Ie({variant:d}),t),...o})}const G={get:{getAll:async()=>(await P.get("/users")).data,getProfile:async()=>(await P.get("/users/profile")).data,getPremium:async()=>(await P.get("/users/premium-status")).data},put:{updateProfile:async t=>(await P.put("/users/profile",t,{headers:{"Content-Type":"multipart/form-data"}})).data}},Z=()=>{const{toast:t}=K(),d=new ue,l=V({queryKey:[S.GET_PREMIUM_STATUS],queryFn:async()=>await G.get.getPremium()}),o=V({queryKey:[S.USER.GET_USER_PROFILE],queryFn:async()=>await G.get.getProfile()}),c=xe({mutationKey:[S.USER.UPDATE_PROFILE],mutationFn:async s=>await G.put.updateProfile(s),onSuccess:async s=>{t({title:"Update successfully",description:(s==null?void 0:s.message)||"Profile updated successfully",variant:"success"})},onError:async s=>{var i,x,f,h;t({title:"Update failed",description:((h=(f=(x=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:x.errors)==null?void 0:f[0])==null?void 0:h.message)||(s==null?void 0:s.message)||"Failed to update profile",variant:"destructive"})},onSettled:()=>{d.invalidateQueries({queryKey:[S.USER.GET_USER_PROFILE]})}});return{getPremiumStatusQuery:l,getUserProfileQuery:o,updateUserProfile:c}},De=b.instanceof(File).optional(),Te=b.object({FullName:b.string().min(2,"Full name must be at least 2 characters long").max(100,"Full name cannot exceed 100 characters").regex(/^[\p{L}\s]+$/u,"Full name can only contain letters and spaces").trim().optional(),PhoneNumber:b.string().regex(/^[+]?[\d\s\-()]+$/,"Phone number format is invalid").min(10,"Phone number must be at least 10 digits").max(10,"Phone number must be at least 10 digits").optional(),Gender:b.number().int("Gender must be an integer").min(0,"Gender must be 0, 1, or 2").max(2,"Gender must be 0, 1, or 2").optional(),Avatar:De,Birthday:b.string().regex(/^\d{4}-\d{2}-\d{2}$/,"Birthday must be in YYYY-MM-DD format").refine(t=>new Date(t)<=new Date,"Birthday cannot be in the future").optional()}).refine(t=>Object.keys(t).length>0,"At least one field must be provided for update"),Be=()=>{const{updateUserProfile:t}=Z();return{updateUserProfileForm:(l={})=>({form:he({resolver:fe(Te),defaultValues:{FullName:"",PhoneNumber:"",Gender:0,Avatar:null,Birthday:"",...l}}),onSubmit:async s=>{try{let i;return s.Avatar&&s.Avatar instanceof File?(i=new FormData,i.append("FullName",s.FullName||""),i.append("PhoneNumber",s.PhoneNumber||""),i.append("Gender",s.Gender.toString()),i.append("Birthday",s.Birthday||""),i.append("Avatar",s.Avatar)):i={FullName:s.FullName||"",PhoneNumber:s.PhoneNumber||"",Gender:s.Gender,Birthday:s.Birthday||""},await t.mutateAsync(i)}catch(i){throw console.error("🚨 User profile update failed:",i),i}},isLoading:t.isPending,error:t.error})}};function Le({isOpen:t,onClose:d,onSave:l,isLoading:o=!1,currentAvatarUrl:c=null}){const[s,i]=u.useState([]),x=p=>{i(p)},f=async()=>{s.length>0&&(await l(s[0].file),h())},h=()=>{i([]),d()};return t?e.jsx("div",{className:"fixed inset-0 bg-[#00000056] bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-md max-h-[90vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center",children:e.jsx(W,{className:"w-4 h-4 text-yellow-600"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Update Profile Picture"})]}),e.jsx("button",{type:"button",onClick:h,className:"text-gray-400 hover:text-gray-600 transition-colors",disabled:o,children:e.jsx(pe,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[c&&s.length===0&&e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Current Avatar"}),e.jsx("div",{className:"w-24 h-24 mx-auto rounded-full overflow-hidden bg-gray-100",children:e.jsx("img",{src:c,alt:"Current avatar",className:"w-full h-full object-cover"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:s.length>0?"New Avatar Preview":"Choose New Avatar"}),e.jsx(ge,{onImageSelect:x,maxFiles:1,maxSize:5*1024*1024,acceptedTypes:["image/jpeg","image/png","image/gif","image/webp"],gridCols:"grid-cols-1",compact:!0,showUploadArea:s.length===0})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-700",children:[e.jsx("strong",{children:"Tips:"})," For best results, use a square image (1:1 ratio) with a minimum size of 200x200 pixels. Supported formats: JPEG, PNG, GIF, WebP. Maximum file size: 5MB."]})})]}),e.jsxs("div",{className:"border-t border-gray-200 p-6 flex justify-end space-x-3",children:[e.jsx(N,{type:"button",variant:"outline",onClick:h,disabled:o,className:"px-4 py-2",children:"Cancel"}),e.jsx(N,{type:"button",onClick:f,disabled:o||s.length===0,className:`px-4 py-2 ${J.HIGHLIGHT_FRAME} disabled:opacity-50 disabled:cursor-not-allowed`,children:o?"Updating...":"Update Avatar"})]})]})}):null}function Re(){var M,O;const{user:t,refreshUser:d}=be(),{toast:l}=K(),{useSendVerifyEmail:o}=we(),{getPremiumStatusQuery:c,getUserProfileQuery:s}=Z(),{updateUserProfileForm:i}=Be(),x=o(),[f,h]=u.useState(!1),[p,ee]=u.useState(!1),[A,j]=u.useState(!1),[g,I]=u.useState({}),[ae,D]=u.useState(!1),[se,T]=u.useState(!1),{data:y,isLoading:E,refetch:w}=s,a=(y==null?void 0:y.data)||t,{form:n,onSubmit:B,isLoading:L}=i({FullName:"",PhoneNumber:"",Gender:0,Birthday:""});u.useEffect(()=>{!y&&!E&&w()},[y,E,w]),u.useEffect(()=>{if(a&&!p){const r={FullName:(a==null?void 0:a.fullName)||"",PhoneNumber:(a==null?void 0:a.phoneNumber)||"",Gender:(a==null?void 0:a.gender)||0,Birthday:a!=null&&a.birthday?new Date(a.birthday).toISOString().slice(0,10):""};n.reset(r),I(r),ee(!0),j(!1)}},[a,n,p]);const R=n.watch();u.useEffect(()=>{if(p&&g){const r=Object.keys(g).some(m=>R[m]!==g[m]);j(r)}},[R,g,p]);const te=()=>{D(!0)},re=async r=>{T(!0);try{const m={FullName:(a==null?void 0:a.fullName)||"",PhoneNumber:(a==null?void 0:a.phoneNumber)||"",Gender:(a==null?void 0:a.gender)||0,Birthday:a!=null&&a.birthday?new Date(a.birthday).toISOString().slice(0,10):"",Avatar:r};await B(m),await Promise.all([w(),d()])}catch(m){console.error("❌ Avatar update error:",m),l({title:"Update failed",description:"Failed to update avatar. Please try again.",variant:"destructive"})}finally{T(!1)}},ie=async r=>{try{const m={FullName:r.FullName||"",PhoneNumber:r.PhoneNumber||"",Gender:r.Gender,Birthday:r.Birthday||""};await B(m),j(!1),I(r),await Promise.all([w(),d()]),l({title:"Profile updated",description:"Your profile information has been updated successfully.",variant:"success"})}catch(m){console.error("❌ Profile form submission error:",m),l({title:"Update failed",description:"Failed to update profile. Please try again.",variant:"destructive"})}},le=()=>{g&&(n.reset(g),j(!1))},ne=async()=>{h(!0);try{const r=await x.refetch();l({title:"Verification email sent",description:r.data.data,variant:"success"})}catch(r){l({title:"Failed to send verification email",description:r.message||"Something went wrong. Please try again.",variant:"destructive"})}finally{h(!1)}},z=r=>new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),oe=()=>{var k;const r=(k=c.data)==null?void 0:k.data;return c.isLoading?e.jsx("div",{className:"w-full mb-4",children:e.jsxs("div",{className:"bg-gray-100 rounded-lg p-3 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded mb-2"}),e.jsx("div",{className:"h-3 bg-gray-300 rounded"})]})}):!r||(a==null?void 0:a.premium)==="FreeTier"?e.jsx("div",{className:"w-full mb-4",children:e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Free Tier"})]}),e.jsx(C,{variant:"secondary",className:"bg-gray-100 text-gray-600 text-xs",children:"Current Plan"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Basic access to courses and features"})]})}):e.jsx("div",{className:"w-full mb-4",children:e.jsxs("div",{className:"bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Se,{className:"w-4 h-4 text-amber-500"}),e.jsx("span",{className:"text-sm font-medium text-amber-800",children:"Premium Member"})]}),e.jsxs(C,{className:"bg-amber-500 text-white text-xs",children:[e.jsx(je,{className:"w-3 h-3 mr-1"}),r.status]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-amber-700",children:[e.jsx(q,{className:"w-3 h-3"}),e.jsxs("span",{children:["Subscribed: ",z(r.subcriptionAt)]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-amber-700",children:[e.jsx(q,{className:"w-3 h-3"}),e.jsxs("span",{children:["Valid until: ",z(r.endDate)]})]})]}),e.jsx("p",{className:"text-xs text-amber-600 mt-2",children:"Full access to all courses and exclusive content"}),new Date(r.endDate)-new Date<7*24*60*60*1e3&&e.jsx("div",{className:"mt-2 p-2 bg-orange-100 border border-orange-200 rounded text-xs text-orange-700",children:"⚠️ Your premium subscription expires soon!"})]})})};return E&&!a?e.jsx("div",{className:"container mx-auto max-w-2xl py-10 px-4",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-300 rounded mb-6"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-7",children:[e.jsx("div",{className:"w-full md:w-1/3 h-96 bg-gray-300 rounded"}),e.jsx("div",{className:"w-full md:w-2/3 h-96 bg-gray-300 rounded"})]})]})}):e.jsxs("div",{className:"container mx-auto max-w-2xl py-10 px-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-primary-yellow mb-6",children:"My Profile"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-7",children:[e.jsxs(U,{className:"w-full md:w-1/3",children:[e.jsx(_,{children:e.jsx(Q,{children:"Profile Photo"})}),e.jsxs(Y,{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative w-32 h-32 rounded-full overflow-hidden bg-amber-50 mb-4 cursor-pointer group",onClick:te,children:[a!=null&&a.avatarUrl?e.jsx("img",{src:a.avatarUrl,alt:"Profile",className:"w-full h-full object-cover group-hover:opacity-75 transition-opacity"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-amber-100 text-amber-800 text-2xl font-bold group-hover:bg-amber-200 transition-colors",children:((O=(M=a==null?void 0:a.fullName)==null?void 0:M.charAt(0))==null?void 0:O.toUpperCase())||"U"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center hover:bg-[#1b1919b9] bg-opacity-90 group-hover:bg-opacity-50 transition-all duration-200",children:e.jsx(W,{className:"text-white opacity-0 group-hover:opacity-100 transition-opacity",size:24})})]}),e.jsx("p",{className:"text-xs text-gray-500 mb-4 text-center",children:"Click to change profile picture"}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"font-medium text-lg",children:a==null?void 0:a.fullName}),e.jsx("p",{className:"text-gray-600",children:a==null?void 0:a.email})]}),oe(),e.jsx("div",{className:"w-full text-center",children:(a==null?void 0:a.status)===0?e.jsxs(C,{className:"bg-green-600",children:[e.jsx(ye,{size:14,className:"mr-1"}),"Verified"]}):e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsxs(C,{className:"bg-primary-yellow",children:[e.jsx(Pe,{size:14,className:"mr-1"}),"Verification Required"]}),e.jsx(N,{variant:"link",size:"sm",onClick:ne,className:"text-primary-blue hover:text-primary-yellow p-0 h-auto",disabled:f,children:f?"Sending...":"Send verification email"})]})})]})]}),e.jsxs(U,{className:"w-full md:w-2/3",children:[e.jsxs(_,{children:[e.jsx(Q,{children:"Personal Information"}),e.jsx(ve,{children:"Update your personal information and how others see you on the platform."})]}),e.jsxs("form",{onSubmit:n.handleSubmit(ie),children:[e.jsx(Y,{className:"space-y-4 gap-2 px-4 py-6",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"fullName",children:"Full Name"}),e.jsx(F,{id:"fullName",placeholder:"Your name",...n.register("FullName")}),n.formState.errors.FullName&&e.jsx("p",{className:"text-red-500 text-xs",children:n.formState.errors.FullName.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"phoneNumber",children:"Phone Number"}),e.jsx(F,{id:"phoneNumber",placeholder:"Your phone number",...n.register("PhoneNumber")}),n.formState.errors.PhoneNumber&&e.jsx("p",{className:"text-red-500 text-xs",children:n.formState.errors.PhoneNumber.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"email",children:"Email Address"}),e.jsx(F,{id:"email",type:"email",placeholder:"Your email",value:(a==null?void 0:a.email)||"",disabled:!0}),e.jsx("p",{className:"text-xs text-gray-500",children:"Email address cannot be changed."})]}),e.jsx(Ge,{className:"my-2"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"gender",children:"Gender"}),e.jsxs("select",{id:"gender",...n.register("Gender",{valueAsNumber:!0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:0,children:"Male"}),e.jsx("option",{value:1,children:"Female"}),e.jsx("option",{value:2,children:"Other"})]}),n.formState.errors.Gender&&e.jsx("p",{className:"text-red-500 text-xs",children:n.formState.errors.Gender.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"birthday",children:"Birthday"}),e.jsx(F,{id:"birthday",type:"date",...n.register("Birthday")}),n.formState.errors.Birthday&&e.jsx("p",{className:"text-red-500 text-xs",children:n.formState.errors.Birthday.message})]})]})}),e.jsxs(Ne,{className:"flex justify-end space-x-2 gap-2",children:[e.jsx(N,{type:"button",variant:"outline",onClick:le,disabled:!A,children:"Cancel"}),e.jsx(N,{type:"submit",disabled:L||!A,className:`${J.HIGHLIGHT_FRAME} rounded-md cursor-pointer ${A?"":"opacity-50 cursor-not-allowed"}`,children:L?"Saving...":"Save changes"})]})]})]})]}),e.jsx(Le,{isOpen:ae,onClose:()=>D(!1),onSave:re,isLoading:se,currentAvatarUrl:a==null?void 0:a.avatarUrl})]})}function Ue(){return e.jsx(Re,{})}export{Ue as default};
