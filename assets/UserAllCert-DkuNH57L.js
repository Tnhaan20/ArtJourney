import{b as B,c as R,H as z,r as h,j as e,v,P as c,p as _,a7 as i,aa as n,A as b,B as C,S as M,ay as O,ad as Y,az as V,L as Z,w as H,f as P,X as Q,aA as X}from"./index-C-krFRSx.js";import{B as q}from"./badge-CVyXMyTl.js";import{S as G}from"./share-2-D0rUfnk2.js";function se(){var N,y;const{user:J}=B(),A=R(),{getUserCertificatesQuery:g,isLoadingCertificates:D,certificatesError:u,getCertificateCount:S}=z(),[d,k]=h.useState(""),[p,L]=h.useState("newest"),[m,j]=h.useState(new Set),l=((N=g.data)==null?void 0:N.data)||[],U=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),f=s=>{const t=new Date,a=new Date(s),r=Math.floor((t-a)/(1e3*60*60*24));return r===0?"Today":r===1?"Yesterday":r<30?`${r} days ago`:r<365?`${Math.floor(r/30)} months ago`:`${Math.floor(r/365)} years ago`},w=l.filter(s=>s.courseName.toLowerCase().includes(d.toLowerCase())).sort((s,t)=>{switch(p){case"newest":return new Date(t.completedAt)-new Date(s.completedAt);case"oldest":return new Date(s.completedAt)-new Date(t.completedAt);case"courseName":return s.courseName.localeCompare(t.courseName);default:return new Date(t.completedAt)-new Date(s.completedAt)}}),$=async s=>{try{j(F=>new Set(F).add(s.id)),console.log("🔽 Starting certificate download:",s.courseName);const t=await fetch(s.certificateImageUrl,{mode:"cors"});if(!t.ok)throw new Error(`Failed to fetch certificate: ${t.statusText}`);const a=await t.blob(),r=window.URL.createObjectURL(a),o=document.createElement("a");o.href=r;const T=s.courseName.replace(/[^a-zA-Z0-9\s]/g,"").replace(/\s+/g,"_").trim(),E=s.certificateImageUrl.split(".").pop()||"jpg";o.download=`${T}_Certificate.${E}`,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(r),console.log("✅ Certificate downloaded successfully")}catch(t){console.error("❌ Download failed:",t),console.log("🔄 Trying fallback download method...");const a=document.createElement("a");a.href=s.certificateImageUrl,a.download=`${s.courseName.replace(/[^a-zA-Z0-9\s]/g,"").replace(/\s+/g,"_")}_Certificate.jpg`,a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a)}finally{j(t=>{const a=new Set(t);return a.delete(s.id),a})}},x=s=>{console.log("👁️ Viewing certificate:",s.id),A(`/certificate/${s.id}`)},I=async s=>{if(navigator.share)try{await navigator.share({title:`${s.courseName} Certificate`,text:`I've completed the ${s.courseName} course and earned a certificate!`,url:s.certificateImageUrl})}catch(t){console.log("Error sharing:",t)}else try{await navigator.clipboard.writeText(s.certificateImageUrl),console.log("📋 Certificate URL copied to clipboard")}catch(t){console.error("Failed to copy to clipboard:",t)}};return D?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-amber-50",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(v,{className:"h-12 w-12 animate-spin text-primary-yellow mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-700 mb-2",children:"Loading Your Certificates"}),e.jsx("p",{className:"text-gray-500",children:"Fetching your achievements..."})]})})})}):u?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-orange-50",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-700 mb-2",children:"Failed to Load Certificates"}),e.jsx("p",{className:"text-gray-500 mb-4",children:u.message||"Something went wrong while loading your certificates."}),e.jsx(c,{onClick:()=>g.refetch(),className:"bg-primary-yellow hover:bg-secondary-yellow text-white",children:"Try Again"})]})})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-amber-50",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-full flex items-center justify-center",children:e.jsx(_,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"My Certificates"}),e.jsx("p",{className:"text-gray-600",children:"Your learning achievements and completed courses"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(i,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(b,{className:"w-8 h-8 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:S()}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Certificates"})]})]})})}),e.jsx(i,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(C,{className:"w-8 h-8 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:l.length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Courses Completed"})]})]})})}),e.jsx(i,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(M,{className:"w-8 h-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:l.length>0?f((y=l.sort((s,t)=>new Date(t.completedAt)-new Date(s.completedAt))[0])==null?void 0:y.completedAt):"None"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Latest Achievement"})]})]})})})]}),l.length>0&&e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Y,{placeholder:"Search certificates by course name...",value:d,onChange:s=>k(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{className:"w-4 h-4 text-gray-500"}),e.jsxs("select",{value:p,onChange:s=>L(s.target.value),className:"border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-yellow",children:[e.jsx("option",{value:"newest",children:"Newest First"}),e.jsx("option",{value:"oldest",children:"Oldest First"}),e.jsx("option",{value:"courseName",children:"Course Name A-Z"})]})]})]})]}),w.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(b,{className:"w-12 h-12 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-700 mb-2",children:l.length===0?"No Certificates Yet":"No Certificates Found"}),e.jsx("p",{className:"text-gray-500 mb-6",children:l.length===0?"Complete courses to earn your first certificate!":`No certificates match "${d}"`}),l.length===0&&e.jsx(Z,{to:"/courses",children:e.jsxs(c,{className:"bg-primary-yellow hover:bg-secondary-yellow text-white",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Browse Courses"]})})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:w.map(s=>e.jsxs(i,{className:"overflow-hidden hover:shadow-lg transition-shadow duration-300",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.certificateImageUrl,alt:`${s.courseName} Certificate`,className:"w-full h-48 object-cover cursor-pointer",onClick:()=>x(s)}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"}),e.jsx("div",{className:"absolute bottom-3 left-3 right-3",children:e.jsx(q,{variant:"secondary",className:"bg-white/90 text-gray-800",children:"Certificate"})}),e.jsx("div",{className:"absolute inset-0 hover:bg-[#00000033] bg-opacity-0 hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center cursor-pointer",onClick:()=>x(s),children:e.jsx("div",{className:"opacity-0 hover:opacity-100 transition-opacity bg-white px-4 py-2 rounded-full text-sm font-medium",children:"Click to view details"})})]}),e.jsxs(n,{className:"p-6",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 mb-2 line-clamp-2",children:s.courseName}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),e.jsxs("span",{children:["Completed ",U(s.completedAt)]})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:f(s.completedAt)})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>x(s),className:"flex-1",children:[e.jsx(Q,{className:"w-4 h-4 mr-1"}),"View Details"]}),e.jsxs(c,{size:"sm",onClick:()=>$(s),disabled:m.has(s.id),className:"bg-primary-yellow hover:bg-secondary-yellow text-white disabled:opacity-50",children:[m.has(s.id)?e.jsx(v,{className:"w-4 h-4 mr-1 animate-spin"}):e.jsx(X,{className:"w-4 h-4 mr-1"}),m.has(s.id)?"Downloading...":"Download"]}),e.jsx(c,{size:"sm",variant:"outline",onClick:()=>I(s),children:e.jsx(G,{className:"w-4 h-4"})})]})]})]},s.id))})]})})}export{se as default};
