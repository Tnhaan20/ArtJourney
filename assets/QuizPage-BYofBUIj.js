import{k as K,l as U,r as C,a6 as V,a7 as W,P as X,j as e,I as h,D as ee,a8 as se,J as te,e as re,T as A,d as ne}from"./index-BgmMvSL4.js";import{P as ae}from"./progress-Dgi6QzQV.js";import{u as ie}from"./use-quiz-store-BMtJJorU.js";import{C as $}from"./circle-alert-DK6Up32m.js";import{C as le}from"./chevron-left-ubI96J3c.js";const oe=c=>{if(!c)return 600;const o=c.split(":");if(o.length===3){const m=parseInt(o[0],10)||0,x=parseInt(o[1],10)||0,g=parseInt(o[2],10)||0;return m*3600+x*60+g}else if(o.length===2){const m=parseInt(o[0],10)||0,x=parseInt(o[1],10)||0;return m*60+x}return 600},y=c=>{if(!c)return"";const o=new Date(c),m=o.getDate().toString().padStart(2,"0"),x=(o.getMonth()+1).toString().padStart(2,"0"),g=o.getFullYear(),i=o.getHours().toString().padStart(2,"0"),t=o.getMinutes().toString().padStart(2,"0");return`${m}/${x}/${g} ${i}:${t}`};function de(){const{courseId:c,moduleId:o,subModuleId:m,learningContentId:x}=K(),g=U(),{quizAttemptId:i,attemptData:t,timeLimit:N,selectedAnswers:d,currentQuestionIndex:n,isQuizComplete:q,updateSelectedAnswer:L,setCurrentQuestionIndex:z,setIsQuizComplete:P,updateAttemptData:M,resetQuizState:H,clearQuizAttempt:E,getAttemptSummary:O}=ie(),S=N?oe(N):600,[f,F]=C.useState(S),{getQuizByLearningContent:R}=V(),{data:p,isLoading:w,error:Q}=R(x,1,10);C.useEffect(()=>{i&&t?console.log("Quiz Attempt Details:",{attemptId:i,startedAt:t.startedAt,learningContentId:t.learningContentId,userId:t.userId,totalPossibleScore:t.totalPossibleScore,isCompleted:t.isCompleted,timeLimit:N}):console.warn("No quiz attempt data found in Zustand store")},[i,t,N]);const s=W.useMemo(()=>{var l;if(!((l=p==null?void 0:p.data)!=null&&l.items))return null;const r=p.data.items.map(a=>{var u;return{id:a.questionId,question:a.questionText,type:a.questionType,points:a.points,orderIndex:a.orderIndex,options:a.questionOptions.sort((j,Z)=>j.orderIndex-Z.orderIndex).map(j=>({id:j.questionOptionId,text:j.optionText,orderIndex:j.orderIndex})),correctAnswer:(u=a.questionOptions[0])==null?void 0:u.questionOptionId,explanation:`This is the explanation for question: ${a.questionText}`}});return{title:"Quiz Assessment",description:"Test your knowledge and understanding.",timeLimit:S,passingScore:70,questions:r.sort((a,u)=>a.orderIndex-u.orderIndex),totalQuestions:p.data.totalCount,attemptId:i,attemptData:t,totalPossibleScore:(t==null?void 0:t.totalPossibleScore)||r.length}},[p,x,S,i,t]);C.useEffect(()=>{if(w||q||!s)return;const r=setInterval(()=>{F(l=>l<=1?(clearInterval(r),T(),0):l-1)},1e3);return()=>clearInterval(r)},[w,q,s]);const B=r=>{L(n,r),i&&console.log("Saving answer for attempt:",i,{questionId:s.questions[n].id,selectedAnswer:r,attemptStartedAt:t==null?void 0:t.startedAt})},G=()=>{n>0&&z(n-1)},Y=()=>{n<s.questions.length-1&&z(n+1)},T=()=>{P(!0);let r=0;s.questions.forEach((l,a)=>{d[a]===l.correctAnswer&&r++}),M({totalScore:r,isCompleted:!0,completedAt:new Date().toISOString(),timeTaken:s.timeLimit-f}),console.log("Quiz completed:",{attemptId:i,answers:d,finalScore:r,totalPossible:s.questions.length,timeTaken:s.timeLimit-f,attemptSummary:O()}),i&&_(i,d,r)},_=async(r,l,a)=>{try{const u={attemptId:r,answers:l,totalScore:a,timeTaken:s.timeLimit-f,completedAt:new Date().toISOString(),learningContentId:t==null?void 0:t.learningContentId,userId:t==null?void 0:t.userId};console.log("Submitting quiz results:",u)}catch(u){console.error("Error submitting quiz results:",u),X({title:"Error",description:"Failed to submit quiz results. Please try again.",variant:"destructive"})}},k=r=>{const l=Math.floor(r/60),a=r%60;return`${l}:${a<10?"0":""}${a}`},b=()=>{let r=0;return s.questions.forEach((l,a)=>{d[a]===l.correctAnswer&&r++}),r},v=(r,l)=>r/l*100,I=()=>{E(),g(`/learn/course/${c}/module/${o}/submodule/${m}`)},D=()=>d[n]!==void 0,J=()=>s==null?void 0:s.questions.every((r,l)=>d[l]!==void 0);return!i&&!w?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-2xl p-8 bg-white rounded-lg shadow-lg",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx($,{className:"h-12 w-12 text-red-500 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Invalid Quiz Session"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No valid quiz attempt found. Please start the quiz again."}),e.jsx(h,{onClick:I,className:"bg-primary-yellow hover:bg-amber-600 text-white",children:"Back to Module"})]})})}):w?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-2xl p-8 bg-white rounded-lg shadow-lg",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(ee,{className:"h-12 w-12 animate-spin text-primary-yellow mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading quiz questions..."}),i&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Attempt ID: ",i]})]})})}):Q?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-2xl p-8 bg-white rounded-lg shadow-lg",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx($,{className:"h-12 w-12 text-red-500 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Failed to Load Quiz"}),e.jsx("p",{className:"text-gray-600 mb-4",children:Q.message||"There was an error loading the quiz questions."}),e.jsx(h,{onClick:()=>window.location.reload(),className:"bg-primary-yellow hover:bg-amber-600 text-white",children:"Try Again"})]})})}):!s||s.questions.length===0?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-2xl p-8 bg-white rounded-lg shadow-lg",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx(se,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"No Quiz Questions Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"This learning content doesn't have any quiz questions yet."}),e.jsx(h,{onClick:I,className:"bg-primary-yellow hover:bg-amber-600 text-white",children:"Back to Module"})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8 px-4",children:e.jsx("div",{className:"container mx-auto",children:q?e.jsxs("div",{className:"w-full max-w-2xl mx-auto bg-white rounded-lg shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-amber-50 p-6 border-b border-amber-100",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Quiz Complete"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Here's how you did!"}),t&&e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:[e.jsxs("p",{children:["Attempt #",i," completed at"," ",y(new Date().toISOString())]}),t.startedAt&&e.jsxs("p",{children:["Started: ",y(t.startedAt)]})]})]}),e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-24 h-24 rounded-full bg-amber-100 mb-4",children:e.jsxs("span",{className:"text-3xl font-bold text-amber-700",children:[v(b(),s.questions.length).toFixed(0),"%"]})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:v(b(),s.questions.length)>=s.passingScore?"Congratulations!":"Almost there!"}),e.jsx("p",{className:"text-gray-600",children:v(b(),s.questions.length)>=s.passingScore?"You passed the quiz successfully.":"You didn't quite reach the passing score. Consider reviewing the material and trying again."})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-6",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Your Score"}),e.jsxs("span",{className:"font-medium text-gray-700",children:[b(),"/",s.questions.length," questions"]})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Passing Score"}),e.jsxs("span",{className:"font-medium text-gray-700",children:[s.passingScore,"%"]})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Time Spent"}),e.jsx("span",{className:"font-medium text-gray-700",children:k(s.timeLimit-f)})]}),(t==null?void 0:t.startedAt)&&e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Started"}),e.jsx("span",{className:"font-medium text-gray-700",children:y(t.startedAt)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Completed"}),e.jsx("span",{className:"font-medium text-gray-700",children:y(new Date().toISOString())})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx(h,{onClick:I,className:`${A.HIGHLIGHT_FRAME} px-6 py-2`,children:"Return to Module"}),v(b(),s.questions.length)<s.passingScore&&e.jsx(h,{onClick:()=>{H(),g(`/learn/course/${c}/module/${o}/submodule/${m}`)},variant:"outline",className:"border-primary-yellow text-primary-yellow hover:bg-amber-50",children:"Try Again"})]})]})]}):e.jsxs("div",{className:"w-full max-w-2xl mx-auto bg-white rounded-lg shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-amber-50 p-6 border-b border-amber-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("button",{onClick:I,className:"flex items-center text-primary-yellow hover:text-amber-600",children:[e.jsx(te,{size:16,className:"mr-1"}),e.jsx("span",{children:"Back to Module"})]}),e.jsxs("div",{className:"flex items-center text-amber-700 bg-amber-100 px-3 py-1 rounded-full",children:[e.jsx(re,{size:16,className:"mr-2"}),e.jsx("span",{className:"font-medium",children:k(f)})]})]}),e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:s.title}),e.jsx("p",{className:"text-gray-600 mt-1",children:s.description}),i&&e.jsxs("div",{className:"mt-2 text-xs text-gray-500 space-y-1",children:[e.jsxs("p",{children:["Attempt ID: ",i]}),(t==null?void 0:t.startedAt)&&e.jsxs("p",{children:["Started: ",y(t.startedAt)]})]})]}),e.jsxs("div",{className:"p-4 bg-white border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Question ",n+1," of"," ",s.questions.length]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[Object.keys(d).length," of"," ",s.questions.length," answered"]})]}),e.jsx(ae,{value:(n+1)/s.questions.length*100,className:"h-2 bg-gray-200",children:e.jsx("div",{className:"h-full bg-primary-yellow rounded-full transition-all duration-300",style:{width:`${(n+1)/s.questions.length*100}%`}})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-2",children:e.jsxs("span",{className:"text-sm text-gray-500",children:[s.questions[n].type," â€¢"," ",s.questions[n].points," point(s)"]})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-6",children:s.questions[n].question}),e.jsx("div",{className:"space-y-3 mb-8",children:s.questions[n].options.map(r=>e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-all duration-200 ${d[n]===r.id?"bg-amber-50 border-amber-300 shadow-sm":"border-gray-200 hover:border-amber-300 hover:bg-amber-25"}`,onClick:()=>B(r.id),children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx("div",{className:`h-5 w-5 border rounded-full flex items-center justify-center transition-all duration-200 ${d[n]===r.id?"border-primary-yellow bg-primary-yellow":"border-gray-300"}`,children:d[n]===r.id?e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"}):e.jsx("span",{className:"text-xs font-medium text-gray-700",children:String.fromCharCode(65+r.orderIndex)})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium text-gray-800",children:r.text})})]})},r.id))}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(h,{onClick:G,disabled:n===0,variant:"outline",className:"flex items-center px-4 py-2 border-gray-300 text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(le,{size:16,className:"mr-1"}),"Previous"]}),e.jsx("div",{className:"flex space-x-3",children:n<s.questions.length-1?e.jsxs(h,{onClick:Y,disabled:!D(),className:`${A.HIGHLIGHT_FRAME} px-6 py-2 flex items-center`,children:["Next",e.jsx(ne,{size:16,className:"ml-1"})]}):e.jsx(h,{onClick:T,disabled:!J(),className:`${A.HIGHLIGHT_FRAME} px-6 py-2`,children:"Complete Quiz"})})]})]})]})})})}function ge(){return e.jsx(de,{})}export{ge as default};
