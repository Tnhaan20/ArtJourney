import{r as N,j as e,ah as oe,_,$ as de,h as ce,c as me,ai as ue,aj as xe,R as he,Z as C,D as F,P as p,v as R,ak as ge,W as pe,f as fe,T as $,e as be}from"./index-CdDrPE2n.js";import{u as je}from"./use-quiz-store-Cfjsoztw.js";import{C as ve}from"./chevron-left-DZ6jI8NL.js";var Q="Progress",T=100,[ye,Me]=oe(Q),[Ne,we]=ye(Q),D=N.forwardRef((t,r)=>{const{__scopeProgress:x,value:l=null,max:o,getValueLabel:c=Ie,...n}=t;(o||o===0)&&!H(o)&&console.error(qe(`${o}`,"Progress"));const g=H(o)?o:T;l!==null&&!O(l,g)&&console.error(Se(`${l}`,"Progress"));const m=O(l,g)?l:null,i=A(m)?c(m,g):void 0;return e.jsx(Ne,{scope:x,value:m,max:g,children:e.jsx(_.div,{"aria-valuemax":g,"aria-valuemin":0,"aria-valuenow":A(m)?m:void 0,"aria-valuetext":i,role:"progressbar","data-state":V(m,g),"data-value":m??void 0,"data-max":g,...n,ref:r})})});D.displayName=Q;var G="ProgressIndicator",B=N.forwardRef((t,r)=>{const{__scopeProgress:x,...l}=t,o=we(G,x);return e.jsx(_.div,{"data-state":V(o.value,o.max),"data-value":o.value??void 0,"data-max":o.max,...l,ref:r})});B.displayName=G;function Ie(t,r){return`${Math.round(t/r*100)}%`}function V(t,r){return t==null?"indeterminate":t===r?"complete":"loading"}function A(t){return typeof t=="number"}function H(t){return A(t)&&!isNaN(t)&&t>0}function O(t,r){return A(t)&&!isNaN(t)&&t<=r&&t>=0}function qe(t,r){return`Invalid prop \`max\` of value \`${t}\` supplied to \`${r}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${T}\`.`}function Se(t,r){return`Invalid prop \`value\` of value \`${t}\` supplied to \`${r}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${T} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var Ce=D,Ae=B;function ze({className:t,value:r,...x}){return e.jsx(Ce,{"data-slot":"progress",className:de("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",t),...x,children:e.jsx(Ae,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(r||0)}%)`}})})}const Pe=t=>{if(!t)return 600;const r=t.split(":");if(r.length===3){const x=parseInt(r[0],10)||0,l=parseInt(r[1],10)||0,o=parseInt(r[2],10)||0;return x*3600+l*60+o}else if(r.length===2){const x=parseInt(r[0],10)||0,l=parseInt(r[1],10)||0;return x*60+l}return 600},y=t=>{if(!t)return"";const r=new Date(t),x=r.getDate().toString().padStart(2,"0"),l=(r.getMonth()+1).toString().padStart(2,"0"),o=r.getFullYear(),c=r.getHours().toString().padStart(2,"0"),n=r.getMinutes().toString().padStart(2,"0");return`${x}/${l}/${o} ${c}:${n}`};function $e(){const{courseId:t,moduleId:r,subModuleId:x,learningContentId:l}=ce(),o=me(),{quizAttemptId:c,attemptData:n,timeLimit:g,selectedAnswers:m,currentQuestionIndex:i,isQuizComplete:z,updateSelectedAnswer:Y,setCurrentQuestionIndex:k,setIsQuizComplete:X,updateAttemptData:Z,resetQuizState:U,clearQuizAttempt:W,getAttemptSummary:Qe}=je(),{submitQuiz:J,formatAnswersForSubmission:K,isLoading:w}=ue(),P=g?Pe(g):600,[I,ee]=N.useState(P),{getQuizByLearningContent:se}=xe(),{data:b,isLoading:q,error:L}=se(l,1,10);N.useEffect(()=>{c&&n?console.log("Quiz Attempt Details:",{attemptId:c,startedAt:n.startedAt,learningContentId:n.learningContentId,userId:n.userId,totalPossibleScore:n.totalPossibleScore,isCompleted:n.isCompleted,timeLimit:g}):console.warn("No quiz attempt data found in Zustand store")},[c,n,g]);const s=he.useMemo(()=>{var u;if(!((u=b==null?void 0:b.data)!=null&&u.items))return null;const a=b.data.items.map(d=>{var h;return{id:d.questionId,question:d.questionText,type:d.questionType,points:d.points,orderIndex:d.orderIndex,options:d.questionOptions.sort((f,le)=>f.orderIndex-le.orderIndex).map(f=>({id:f.questionOptionId,text:f.optionText,orderIndex:f.orderIndex})),correctAnswer:(h=d.questionOptions[0])==null?void 0:h.questionOptionId,explanation:`This is the explanation for question: ${d.questionText}`}});return{title:"Quiz Assessment",description:"Test your knowledge and understanding.",timeLimit:P,passingScore:70,questions:a.sort((d,h)=>d.orderIndex-h.orderIndex),totalQuestions:b.data.totalCount,attemptId:c,attemptData:n,totalPossibleScore:(n==null?void 0:n.totalPossibleScore)||a.length}},[b,l,P,c,n]);N.useEffect(()=>{if(q||z||!s)return;const a=setInterval(()=>{ee(u=>u<=1?(clearInterval(a),M(),0):u-1)},1e3);return()=>clearInterval(a)},[q,z,s]);const te=a=>{Y(i,a),console.log("Answer selected:",{attemptId:c,questionId:s.questions[i].id,questionIndex:i,selectedOptionId:a,questionText:s.questions[i].question})},re=()=>{i>0&&k(i-1)},ae=()=>{i<s.questions.length-1&&k(i+1)},M=async()=>{var d;X(!0);let a=0;s.questions.forEach((h,f)=>{m[f]===h.correctAnswer&&a++}),Z({totalScore:a,isCompleted:!0,completedAt:new Date().toISOString(),timeTaken:s.timeLimit-I});const u=K(m,c,s.questions);if(console.log("Quiz completion data:",{learningContentId:parseInt(l),quizAttemptId:c,userAnswers:u,finalScore:a,totalPossible:s.questions.length,timeTaken:s.timeLimit-I}),c&&u.length>0)try{const h=await J(parseInt(l),c,u);h.success?(console.log("✅ Quiz submitted successfully:",h.data),C({title:"Quiz Completed!",description:"Your quiz has been submitted successfully.",variant:"success"}),setTimeout(()=>{v()},3e3)):(console.error("❌ Quiz submission failed:",h.error),C({title:"Submission Failed",description:((d=h.error)==null?void 0:d.message)||"Failed to submit quiz. Please try again.",variant:"destructive"}))}catch(h){console.error("❌ Error during quiz submission:",h),C({title:"Submission Error",description:"An unexpected error occurred while submitting the quiz.",variant:"destructive"})}else console.warn("No answers to submit or missing attempt ID"),C({title:"No Answers",description:"No answers found to submit.",variant:"destructive"})},E=a=>{const u=Math.floor(a/60),d=a%60;return`${u}:${d<10?"0":""}${d}`},j=()=>{let a=0;return s.questions.forEach((u,d)=>{m[d]===u.correctAnswer&&a++}),a},S=(a,u)=>a/u*100,v=()=>{W(),o(`/learn/course/${t}/module/${r}/submodule/${x}`)},ne=()=>m[i]!==void 0,ie=()=>s==null?void 0:s.questions.every((a,u)=>m[u]!==void 0);return!c&&!q?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-2xl p-8 bg-white rounded-lg shadow-lg",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx(F,{className:"h-12 w-12 text-red-500 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Invalid Quiz Session"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No valid quiz attempt found. Please start the quiz again."}),e.jsx(p,{onClick:v,className:"bg-primary-yellow hover:bg-amber-600 text-white",children:"Back to Module"})]})})}):q?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-2xl p-8 bg-white rounded-lg shadow-lg",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(R,{className:"h-12 w-12 animate-spin text-primary-yellow mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading quiz questions..."})]})})}):L?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-2xl p-8 bg-white rounded-lg shadow-lg",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx(F,{className:"h-12 w-12 text-red-500 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Failed to Load Quiz"}),e.jsx("p",{className:"text-gray-600 mb-4",children:L.message||"There was an error loading the quiz questions."}),e.jsx(p,{onClick:()=>window.location.reload(),className:"bg-primary-yellow hover:bg-amber-600 text-white",children:"Try Again"})]})})}):!s||s.questions.length===0?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-2xl p-8 bg-white rounded-lg shadow-lg",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx(ge,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"No Quiz Questions Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"This learning content doesn't have any quiz questions yet."}),e.jsx(p,{onClick:v,className:"bg-primary-yellow hover:bg-amber-600 text-white",children:"Back to Module"})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8 px-4",children:e.jsx("div",{className:"container mx-auto",children:z?e.jsxs("div",{className:"w-full max-w-2xl mx-auto bg-white rounded-lg shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-amber-50 p-6 border-b border-amber-100",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Quiz Complete"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Here's how you did!"}),n&&e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:[e.jsxs("p",{children:["Attempt #",c," completed at"," ",y(new Date().toISOString())]}),n.startedAt&&e.jsxs("p",{children:["Started: ",y(n.startedAt)]})]})]}),e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-24 h-24 rounded-full bg-amber-100 mb-4",children:e.jsxs("span",{className:"text-3xl font-bold text-amber-700",children:[S(j(),s.questions.length).toFixed(0),"%"]})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:S(j(),s.questions.length)>=s.passingScore?"Congratulations!":"Almost there!"}),e.jsx("p",{className:"text-gray-600",children:S(j(),s.questions.length)>=s.passingScore?"You passed the quiz successfully.":"You didn't quite reach the passing score. Consider reviewing the material and trying again."})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-6",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Your Score"}),e.jsxs("span",{className:"font-medium text-gray-700",children:[j(),"/",s.questions.length," questions"]})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Passing Score"}),e.jsxs("span",{className:"font-medium text-gray-700",children:[s.passingScore,"%"]})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Time Spent"}),e.jsx("span",{className:"font-medium text-gray-700",children:E(s.timeLimit-I)})]}),(n==null?void 0:n.startedAt)&&e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Started"}),e.jsx("span",{className:"font-medium text-gray-700",children:y(n.startedAt)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Completed"}),e.jsx("span",{className:"font-medium text-gray-700",children:y(new Date().toISOString())})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx(p,{onClick:v,className:`${$.HIGHLIGHT_FRAME} px-6 py-2`,disabled:w,children:"Return to Module"}),S(j(),s.questions.length)<s.passingScore&&e.jsx(p,{onClick:()=>{U(),o(`/learn/course/${t}/module/${r}/submodule/${x}`)},variant:"outline",className:"border-primary-yellow text-primary-yellow hover:bg-amber-50",disabled:w,children:"Try Again"})]})]})]}):e.jsxs("div",{className:"w-full max-w-2xl mx-auto bg-white rounded-lg shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-amber-50 p-6 border-b border-amber-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("button",{onClick:v,className:"flex items-center text-primary-yellow hover:text-amber-600",children:[e.jsx(pe,{size:16,className:"mr-1"}),e.jsx("span",{children:"Back to Module"})]}),e.jsxs("div",{className:"flex items-center text-amber-700 bg-amber-100 px-3 py-1 rounded-full",children:[e.jsx(fe,{size:16,className:"mr-2"}),e.jsx("span",{className:"font-medium",children:E(I)})]})]}),e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:s.title}),e.jsx("p",{className:"text-gray-600 mt-1",children:s.description}),c&&e.jsx("div",{className:"mt-2 text-xs text-gray-500 space-y-1",children:(n==null?void 0:n.startedAt)&&e.jsxs("p",{children:["Started: ",y(n.startedAt)]})})]}),e.jsxs("div",{className:"p-4 bg-white border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Question ",i+1," of"," ",s.questions.length]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[Object.keys(m).length," of"," ",s.questions.length," answered"]})]}),e.jsx(ze,{value:(i+1)/s.questions.length*100,className:"h-2 bg-gray-200",children:e.jsx("div",{className:"h-full bg-primary-yellow rounded-full transition-all duration-300",style:{width:`${(i+1)/s.questions.length*100}%`}})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-2",children:e.jsxs("span",{className:"text-sm text-gray-500",children:[s.questions[i].type," •"," ",s.questions[i].points," point(s)"]})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-6",children:s.questions[i].question}),e.jsx("div",{className:"space-y-3 mb-8",children:s.questions[i].options.map(a=>e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-all duration-200 ${m[i]===a.id?"bg-amber-50 border-amber-300 shadow-sm":"border-gray-200 hover:border-amber-300 hover:bg-amber-25"}`,onClick:()=>te(a.id),children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx("div",{className:`h-5 w-5 border rounded-full flex items-center justify-center transition-all duration-200 ${m[i]===a.id?"border-primary-yellow bg-primary-yellow":"border-gray-300"}`,children:m[i]===a.id?e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"}):e.jsx("span",{className:"text-xs font-medium text-gray-700",children:String.fromCharCode(65+a.orderIndex)})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium text-gray-800",children:a.text})})]})},a.id))}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(p,{onClick:re,disabled:i===0,variant:"outline",className:"flex items-center px-4 py-2 border-gray-300 text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ve,{size:16,className:"mr-1"}),"Previous"]}),e.jsx("div",{className:"flex space-x-3",children:i<s.questions.length-1?e.jsxs(p,{onClick:ae,disabled:!ne(),className:`${$.HIGHLIGHT_FRAME} px-6 py-2 flex items-center`,children:["Next",e.jsx(be,{size:16,className:"ml-1"})]}):e.jsx(p,{onClick:M,disabled:!ie()||w,className:`${$.HIGHLIGHT_FRAME} px-6 py-2`,children:w?e.jsxs(e.Fragment,{children:[e.jsx(R,{size:16,className:"mr-2 animate-spin"}),"Submitting..."]}):"Complete Quiz"})})]})]})]})})})}function Ee(){return e.jsx($e,{})}export{Ee as default};
