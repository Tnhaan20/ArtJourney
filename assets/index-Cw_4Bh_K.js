import{r as u,j as e,W as ee,X as Y,Y as ae,Z as te,_ as y,$ as q,a0 as se,a1 as O,a2 as re,a3 as j,a4 as x,a5 as ie,a6 as ne,b as le,a7 as V,a8 as k,a9 as M,aa as _,C as oe,I as F,ab as de,ac as b,ad as N,ae as ce,T as me,S as ue,w as G}from"./index-DloQCMg4.js";import{u as xe}from"./use-auth-wjQLhin0.js";import{C as he}from"./camera-B230dXwD.js";import{C as fe}from"./circle-alert-CM8_gDmS.js";import{C as pe}from"./crown-B1X855Fr.js";var ge="Separator",Q="horizontal",be=["horizontal","vertical"],B=u.forwardRef((t,n)=>{const{decorative:o,orientation:l=Q,...d}=t,s=ve(l)?l:Q,h=o?{role:"none"}:{"aria-orientation":s==="vertical"?s:void 0,role:"separator"};return e.jsx(ee.div,{"data-orientation":s,...h,...d,ref:n})});B.displayName=ge;function ve(t){return be.includes(t)}var ye=B;function je({className:t,orientation:n="horizontal",decorative:o=!0,...l}){return e.jsx(ye,{"data-slot":"separator-root",decorative:o,orientation:n,className:Y("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",t),...l})}const Ne=te("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function w({className:t,variant:n,asChild:o=!1,...l}){const d=o?ae:"span";return e.jsx(d,{"data-slot":"badge",className:Y(Ne({variant:n}),t),...l})}const C={get:{getAll:async()=>(await y.get("/users")).data,getProfile:async()=>(await y.get("/users/profile")).data,getPremium:async()=>(await y.get("/users/premium-status")).data},put:{updateProfile:async t=>(await y.put("/users/profile",t,{headers:{"Content-Type":"multipart/form-data"}})).data}},$=()=>{const{toast:t}=q(),n=new se,o=O({queryKey:[j.GET_PREMIUM_STATUS],queryFn:async()=>await C.get.getPremium()}),l=O({queryKey:[j.USER.GET_USER_PROFILE],queryFn:async()=>await C.get.getProfile()}),d=re({mutationKey:[j.USER.UPDATE_PROFILE],mutationFn:async s=>await C.put.updateProfile(s),onSuccess:async s=>{t({title:"Update successfully",description:(s==null?void 0:s.message)||"Profile updated successfully",variant:"success"})},onError:async s=>{var m,h,f,p;t({title:"Update failed",description:((p=(f=(h=(m=s==null?void 0:s.response)==null?void 0:m.data)==null?void 0:h.errors)==null?void 0:f[0])==null?void 0:p.message)||(s==null?void 0:s.message)||"Failed to update profile",variant:"destructive"})},onSettled:()=>{n.invalidateQueries({queryKey:[j.USER.GET_USER_PROFILE]})}});return{getPremiumStatusQuery:o,getUserProfileQuery:l,updateUserProfile:d}},we=x.object({fullName:x.string().min(2,"Full name must be at least 2 characters long").max(100,"Full name cannot exceed 100 characters").regex(/^[a-zA-Z\s]+$/,"Full name can only contain letters and spaces").trim().optional(),phoneNumber:x.string().regex(/^[+]?[\d\s\-()]+$/,"Phone number format is invalid").min(10,"Phone number must be at least 10 digits").max(10,"Phone number must be at least 10 digits").optional(),gender:x.number().int("Gender must be an integer").min(0,"Gender must be 0, 1, or 2").max(2,"Gender must be 0, 1, or 2").optional(),avatarUrl:x.string().url("Avatar URL must be a valid URL").or(x.literal("")).optional(),birthday:x.string().regex(/^\d{4}-\d{2}-\d{2}$/,"Birthday must be in YYYY-MM-DD format").refine(t=>new Date(t)<=new Date,"Birthday cannot be in the future").optional()}).refine(t=>Object.keys(t).length>0,"At least one field must be provided for update"),Se=()=>{const{updateUserProfile:t}=$();return{updateUserProfileForm:(o={})=>{const l=ie({resolver:ne(we),defaultValues:{fullName:"",phoneNumber:"",gender:0,avatarUrl:"",birthday:"",...o}}),d=async s=>{try{await t.mutateAsync(s)}catch(m){throw console.error("User profile update failed:",m),m}};return{form:l,onSubmit:l.handleSubmit(d),isLoading:t.isPending,error:t.error}}}};function Pe(){var D,z;const{user:t}=le(),{toast:n}=q(),o=u.useRef(null),{useSendVerifyEmail:l}=xe(),{getPremiumStatusQuery:d,getUserProfileQuery:s}=$(),{updateUserProfileForm:m}=Se(),h=l(),[f,p]=u.useState(null),[Fe,K]=u.useState(null),[E,A]=u.useState(!1),[R,I]=u.useState(!1),{data:g,isLoading:S,refetch:P}=s,a=(g==null?void 0:g.data)||t,{form:i,onSubmit:H,isLoading:L}=m({fullName:(a==null?void 0:a.fullName)||(a==null?void 0:a.name)||"",phoneNumber:(a==null?void 0:a.phoneNumber)||(a==null?void 0:a.phone)||"",gender:(a==null?void 0:a.gender)||0,avatarUrl:(a==null?void 0:a.avatarUrl)||(a==null?void 0:a.avatar)||"",birthday:a!=null&&a.birthday?new Date(a.birthday).toISOString().slice(0,10):""});u.useEffect(()=>{!g&&!S&&P()},[g,S,P]),u.useEffect(()=>{a&&!R&&(i.reset({fullName:(a==null?void 0:a.fullName)||"",phoneNumber:(a==null?void 0:a.phoneNumber)||"",gender:(a==null?void 0:a.gender)||0,avatarUrl:(a==null?void 0:a.avatarUrl)||"",birthday:a!=null&&a.birthday?new Date(a.birthday).toISOString().slice(0,10):""}),I(!0))},[a,i,R]);const U=r=>{const c=r.target.files[0];if(c){if(!c.type.startsWith("image/")){n({title:"Invalid file type",description:"Please select an image file.",variant:"destructive"});return}if(c.size>5*1024*1024){n({title:"File too large",description:"Please select an image smaller than 5MB.",variant:"destructive"});return}const v=URL.createObjectURL(c);p(v),K(c),i.setValue("avatarUrl",c)}},W=()=>{var r;(r=o.current)==null||r.click()},Z=async r=>{try{await H(r),p(null),await P(),I(!1)}catch(c){console.error("Form submission error:",c)}},X=async()=>{A(!0);try{const r=await h.refetch();n({title:"Verification email sent",description:r.data.data,variant:"success"})}catch(r){n({title:"Failed to send verification email",description:r.message||"Something went wrong. Please try again.",variant:"destructive"})}finally{A(!1)}},T=r=>new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),J=()=>{var v;const r=(v=d.data)==null?void 0:v.data;return d.isLoading?e.jsx("div",{className:"w-full mb-4",children:e.jsxs("div",{className:"bg-gray-100 rounded-lg p-3 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded mb-2"}),e.jsx("div",{className:"h-3 bg-gray-300 rounded"})]})}):!r||(a==null?void 0:a.premium)==="FreeTier"?e.jsx("div",{className:"w-full mb-4",children:e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Free Tier"})]}),e.jsx(w,{variant:"secondary",className:"bg-gray-100 text-gray-600 text-xs",children:"Current Plan"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Basic access to courses and features"})]})}):e.jsx("div",{className:"w-full mb-4",children:e.jsxs("div",{className:"bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{className:"w-4 h-4 text-amber-500"}),e.jsx("span",{className:"text-sm font-medium text-amber-800",children:"Premium Member"})]}),e.jsxs(w,{className:"bg-amber-500 text-white text-xs",children:[e.jsx(ue,{className:"w-3 h-3 mr-1"}),r.status]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-amber-700",children:[e.jsx(G,{className:"w-3 h-3"}),e.jsxs("span",{children:["Subscribed: ",T(r.subcriptionAt)]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-amber-700",children:[e.jsx(G,{className:"w-3 h-3"}),e.jsxs("span",{children:["Valid until: ",T(r.endDate)]})]})]}),e.jsx("p",{className:"text-xs text-amber-600 mt-2",children:"Full access to all courses and exclusive content"}),new Date(r.endDate)-new Date<7*24*60*60*1e3&&e.jsx("div",{className:"mt-2 p-2 bg-orange-100 border border-orange-200 rounded text-xs text-orange-700",children:"⚠️ Your premium subscription expires soon!"})]})})};return S&&!a?e.jsx("div",{className:"container mx-auto max-w-2xl py-10 px-4",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-300 rounded mb-6"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-7",children:[e.jsx("div",{className:"w-full md:w-1/3 h-96 bg-gray-300 rounded"}),e.jsx("div",{className:"w-full md:w-2/3 h-96 bg-gray-300 rounded"})]})]})}):e.jsxs("div",{className:"container mx-auto max-w-2xl py-10 px-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-primary-yellow mb-6",children:"My Profile"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-7",children:[e.jsxs(V,{className:"w-full md:w-1/3",children:[e.jsx(k,{children:e.jsx(M,{children:"Profile Photo"})}),e.jsxs(_,{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative w-32 h-32 rounded-full overflow-hidden bg-amber-50 mb-4 cursor-pointer group",onClick:W,children:[f||a!=null&&a.avatarUrl?e.jsx("img",{src:f||a.avatarUrl,alt:"Profile",className:"w-full h-full object-cover group-hover:opacity-75 transition-opacity"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-amber-100 text-amber-800 text-2xl font-bold group-hover:bg-amber-200 transition-colors",children:((z=(D=a==null?void 0:a.fullName)==null?void 0:D.charAt(0))==null?void 0:z.toUpperCase())||"U"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-200",children:e.jsx(he,{className:"text-white opacity-0 group-hover:opacity-100 transition-opacity",size:24})})]}),e.jsx("input",{ref:o,type:"file",accept:"image/*",onChange:U,className:"hidden"}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"font-medium text-lg",children:a==null?void 0:a.fullName}),e.jsx("p",{className:"text-gray-600",children:a==null?void 0:a.email})]}),J(),e.jsx("div",{className:"w-full text-center",children:(a==null?void 0:a.status)===0?e.jsxs(w,{className:"bg-green-600",children:[e.jsx(oe,{size:14,className:"mr-1"}),"Verified"]}):e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsxs(w,{className:"bg-primary-yellow",children:[e.jsx(fe,{size:14,className:"mr-1"}),"Verification Required"]}),e.jsx(F,{variant:"link",size:"sm",onClick:X,className:"text-primary-blue hover:text-primary-yellow p-0 h-auto",disabled:E,children:E?"Sending...":"Send verification email"})]})})]})]}),e.jsxs(V,{className:"w-full md:w-2/3",children:[e.jsxs(k,{children:[e.jsx(M,{children:"Personal Information"}),e.jsx(de,{children:"Update your personal information and how others see you on the platform."})]}),e.jsxs("form",{onSubmit:i.handleSubmit(Z),children:[e.jsx(_,{className:"space-y-4 gap-2 px-4 py-6",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"fullName",children:"Full Name"}),e.jsx(N,{id:"fullName",placeholder:"Your name",...i.register("fullName")}),i.formState.errors.fullName&&e.jsx("p",{className:"text-red-500 text-xs",children:i.formState.errors.fullName.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"phoneNumber",children:"Phone Number"}),e.jsx(N,{id:"phoneNumber",placeholder:"Your phone number",...i.register("phoneNumber")}),i.formState.errors.phoneNumber&&e.jsx("p",{className:"text-red-500 text-xs",children:i.formState.errors.phoneNumber.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"email",children:"Email Address"}),e.jsx(N,{id:"email",type:"email",placeholder:"Your email",value:(a==null?void 0:a.email)||"",disabled:!0}),e.jsx("p",{className:"text-xs text-gray-500",children:"Email address cannot be changed."})]}),e.jsx(je,{className:"my-2"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"gender",children:"Gender"}),e.jsxs("select",{id:"gender",...i.register("gender",{valueAsNumber:!0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:0,children:"Male"}),e.jsx("option",{value:1,children:"Female"}),e.jsx("option",{value:2,children:"Other"})]}),i.formState.errors.gender&&e.jsx("p",{className:"text-red-500 text-xs",children:i.formState.errors.gender.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"birthday",children:"Birthday"}),e.jsx(N,{id:"birthday",type:"date",...i.register("birthday")}),i.formState.errors.birthday&&e.jsx("p",{className:"text-red-500 text-xs",children:i.formState.errors.birthday.message})]})]})}),e.jsxs(ce,{className:"flex justify-end space-x-2 gap-2",children:[e.jsx(F,{type:"button",variant:"outline",onClick:()=>i.reset(),children:"Cancel"}),e.jsx(F,{type:"submit",disabled:L,className:`${me.HIGHLIGHT_FRAME} rounded-md cursor-pointer`,children:L?"Saving...":"Save changes"})]})]})]})]})]})}function Le(){return e.jsx(Pe,{})}export{Le as default};
