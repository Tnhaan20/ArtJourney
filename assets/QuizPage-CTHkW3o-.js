import{k as W,l as X,a6 as ee,r as A,a7 as se,a8 as te,P as S,j as e,I as h,D as P,a9 as re,J as ne,e as ie,T as Q,d as ae}from"./index-RPoGuoUr.js";import{P as le}from"./progress-DehvmxTa.js";import{u as oe}from"./use-quiz-store-BLYyi7VS.js";import{C as M}from"./circle-alert-6jz5Gr2U.js";import{C as ce}from"./chevron-left-CgOEJzqk.js";const de=u=>{if(!u)return 600;const o=u.split(":");if(o.length===3){const x=parseInt(o[0],10)||0,d=parseInt(o[1],10)||0,p=parseInt(o[2],10)||0;return x*3600+d*60+p}else if(o.length===2){const x=parseInt(o[0],10)||0,d=parseInt(o[1],10)||0;return x*60+d}return 600},y=u=>{if(!u)return"";const o=new Date(u),x=o.getDate().toString().padStart(2,"0"),d=(o.getMonth()+1).toString().padStart(2,"0"),p=o.getFullYear(),i=o.getHours().toString().padStart(2,"0"),r=o.getMinutes().toString().padStart(2,"0");return`${x}/${d}/${p} ${i}:${r}`};function me(){const{courseId:u,moduleId:o,subModuleId:x,learningContentId:d}=W(),p=X(),{quizAttemptId:i,attemptData:r,timeLimit:N,selectedAnswers:m,currentQuestionIndex:n,isQuizComplete:C,updateSelectedAnswer:F,setCurrentQuestionIndex:T,setIsQuizComplete:H,updateAttemptData:E,resetQuizState:O,clearQuizAttempt:B,getAttemptSummary:ue}=oe(),{submitQuiz:D,formatAnswersForSubmission:G,isLoading:w}=ee(),z=N?de(N):600,[v,R]=A.useState(z),{getQuizByLearningContent:Y}=se(),{data:b,isLoading:q,error:k}=Y(d,1,10);A.useEffect(()=>{i&&r?console.log("Quiz Attempt Details:",{attemptId:i,startedAt:r.startedAt,learningContentId:r.learningContentId,userId:r.userId,totalPossibleScore:r.totalPossibleScore,isCompleted:r.isCompleted,timeLimit:N}):console.warn("No quiz attempt data found in Zustand store")},[i,r,N]);const s=te.useMemo(()=>{var l;if(!((l=b==null?void 0:b.data)!=null&&l.items))return null;const t=b.data.items.map(a=>{var c;return{id:a.questionId,question:a.questionText,type:a.questionType,points:a.points,orderIndex:a.orderIndex,options:a.questionOptions.sort((g,V)=>g.orderIndex-V.orderIndex).map(g=>({id:g.questionOptionId,text:g.optionText,orderIndex:g.orderIndex})),correctAnswer:(c=a.questionOptions[0])==null?void 0:c.questionOptionId,explanation:`This is the explanation for question: ${a.questionText}`}});return{title:"Quiz Assessment",description:"Test your knowledge and understanding.",timeLimit:z,passingScore:70,questions:t.sort((a,c)=>a.orderIndex-c.orderIndex),totalQuestions:b.data.totalCount,attemptId:i,attemptData:r,totalPossibleScore:(r==null?void 0:r.totalPossibleScore)||t.length}},[b,d,z,i,r]);A.useEffect(()=>{if(q||C||!s)return;const t=setInterval(()=>{R(l=>l<=1?(clearInterval(t),$(),0):l-1)},1e3);return()=>clearInterval(t)},[q,C,s]);const _=t=>{F(n,t),console.log("Answer selected:",{attemptId:i,questionId:s.questions[n].id,questionIndex:n,selectedOptionId:t,questionText:s.questions[n].question})},J=()=>{n>0&&T(n-1)},Z=()=>{n<s.questions.length-1&&T(n+1)},$=async()=>{var a;H(!0);let t=0;s.questions.forEach((c,g)=>{m[g]===c.correctAnswer&&t++}),E({totalScore:t,isCompleted:!0,completedAt:new Date().toISOString(),timeTaken:s.timeLimit-v});const l=G(m,i,s.questions);if(console.log("Quiz completion data:",{learningContentId:parseInt(d),quizAttemptId:i,userAnswers:l,finalScore:t,totalPossible:s.questions.length,timeTaken:s.timeLimit-v}),i&&l.length>0)try{const c=await D(parseInt(d),i,l);c.success?(console.log("✅ Quiz submitted successfully:",c.data),S({title:"Quiz Completed!",description:"Your quiz has been submitted successfully.",variant:"success"}),setTimeout(()=>{j()},3e3)):(console.error("❌ Quiz submission failed:",c.error),S({title:"Submission Failed",description:((a=c.error)==null?void 0:a.message)||"Failed to submit quiz. Please try again.",variant:"destructive"}))}catch(c){console.error("❌ Error during quiz submission:",c),S({title:"Submission Error",description:"An unexpected error occurred while submitting the quiz.",variant:"destructive"})}else console.warn("No answers to submit or missing attempt ID"),S({title:"No Answers",description:"No answers found to submit.",variant:"destructive"})},L=t=>{const l=Math.floor(t/60),a=t%60;return`${l}:${a<10?"0":""}${a}`},f=()=>{let t=0;return s.questions.forEach((l,a)=>{m[a]===l.correctAnswer&&t++}),t},I=(t,l)=>t/l*100,j=()=>{B(),p(`/learn/course/${u}/module/${o}/submodule/${x}`)},K=()=>m[n]!==void 0,U=()=>s==null?void 0:s.questions.every((t,l)=>m[l]!==void 0);return!i&&!q?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-2xl p-8 bg-white rounded-lg shadow-lg",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx(M,{className:"h-12 w-12 text-red-500 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Invalid Quiz Session"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No valid quiz attempt found. Please start the quiz again."}),e.jsx(h,{onClick:j,className:"bg-primary-yellow hover:bg-amber-600 text-white",children:"Back to Module"})]})})}):q?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-2xl p-8 bg-white rounded-lg shadow-lg",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(P,{className:"h-12 w-12 animate-spin text-primary-yellow mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading quiz questions..."}),i&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Attempt ID: ",i]})]})})}):k?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-2xl p-8 bg-white rounded-lg shadow-lg",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx(M,{className:"h-12 w-12 text-red-500 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Failed to Load Quiz"}),e.jsx("p",{className:"text-gray-600 mb-4",children:k.message||"There was an error loading the quiz questions."}),e.jsx(h,{onClick:()=>window.location.reload(),className:"bg-primary-yellow hover:bg-amber-600 text-white",children:"Try Again"})]})})}):!s||s.questions.length===0?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-2xl p-8 bg-white rounded-lg shadow-lg",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx(re,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"No Quiz Questions Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"This learning content doesn't have any quiz questions yet."}),e.jsx(h,{onClick:j,className:"bg-primary-yellow hover:bg-amber-600 text-white",children:"Back to Module"})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8 px-4",children:e.jsx("div",{className:"container mx-auto",children:C?e.jsxs("div",{className:"w-full max-w-2xl mx-auto bg-white rounded-lg shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-amber-50 p-6 border-b border-amber-100",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Quiz Complete"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Here's how you did!"}),r&&e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:[e.jsxs("p",{children:["Attempt #",i," completed at"," ",y(new Date().toISOString())]}),r.startedAt&&e.jsxs("p",{children:["Started: ",y(r.startedAt)]})]})]}),e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-24 h-24 rounded-full bg-amber-100 mb-4",children:e.jsxs("span",{className:"text-3xl font-bold text-amber-700",children:[I(f(),s.questions.length).toFixed(0),"%"]})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:I(f(),s.questions.length)>=s.passingScore?"Congratulations!":"Almost there!"}),e.jsx("p",{className:"text-gray-600",children:I(f(),s.questions.length)>=s.passingScore?"You passed the quiz successfully.":"You didn't quite reach the passing score. Consider reviewing the material and trying again."})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-6",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Your Score"}),e.jsxs("span",{className:"font-medium text-gray-700",children:[f(),"/",s.questions.length," questions"]})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Passing Score"}),e.jsxs("span",{className:"font-medium text-gray-700",children:[s.passingScore,"%"]})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Time Spent"}),e.jsx("span",{className:"font-medium text-gray-700",children:L(s.timeLimit-v)})]}),(r==null?void 0:r.startedAt)&&e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Started"}),e.jsx("span",{className:"font-medium text-gray-700",children:y(r.startedAt)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Completed"}),e.jsx("span",{className:"font-medium text-gray-700",children:y(new Date().toISOString())})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx(h,{onClick:j,className:`${Q.HIGHLIGHT_FRAME} px-6 py-2`,disabled:w,children:"Return to Module"}),I(f(),s.questions.length)<s.passingScore&&e.jsx(h,{onClick:()=>{O(),p(`/learn/course/${u}/module/${o}/submodule/${x}`)},variant:"outline",className:"border-primary-yellow text-primary-yellow hover:bg-amber-50",disabled:w,children:"Try Again"})]})]})]}):e.jsxs("div",{className:"w-full max-w-2xl mx-auto bg-white rounded-lg shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-amber-50 p-6 border-b border-amber-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("button",{onClick:j,className:"flex items-center text-primary-yellow hover:text-amber-600",children:[e.jsx(ne,{size:16,className:"mr-1"}),e.jsx("span",{children:"Back to Module"})]}),e.jsxs("div",{className:"flex items-center text-amber-700 bg-amber-100 px-3 py-1 rounded-full",children:[e.jsx(ie,{size:16,className:"mr-2"}),e.jsx("span",{className:"font-medium",children:L(v)})]})]}),e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:s.title}),e.jsx("p",{className:"text-gray-600 mt-1",children:s.description}),i&&e.jsxs("div",{className:"mt-2 text-xs text-gray-500 space-y-1",children:[e.jsxs("p",{children:["Attempt ID: ",i]}),(r==null?void 0:r.startedAt)&&e.jsxs("p",{children:["Started: ",y(r.startedAt)]})]})]}),e.jsxs("div",{className:"p-4 bg-white border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Question ",n+1," of"," ",s.questions.length]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[Object.keys(m).length," of"," ",s.questions.length," answered"]})]}),e.jsx(le,{value:(n+1)/s.questions.length*100,className:"h-2 bg-gray-200",children:e.jsx("div",{className:"h-full bg-primary-yellow rounded-full transition-all duration-300",style:{width:`${(n+1)/s.questions.length*100}%`}})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-2",children:e.jsxs("span",{className:"text-sm text-gray-500",children:[s.questions[n].type," •"," ",s.questions[n].points," point(s)"]})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-6",children:s.questions[n].question}),e.jsx("div",{className:"space-y-3 mb-8",children:s.questions[n].options.map(t=>e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-all duration-200 ${m[n]===t.id?"bg-amber-50 border-amber-300 shadow-sm":"border-gray-200 hover:border-amber-300 hover:bg-amber-25"}`,onClick:()=>_(t.id),children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx("div",{className:`h-5 w-5 border rounded-full flex items-center justify-center transition-all duration-200 ${m[n]===t.id?"border-primary-yellow bg-primary-yellow":"border-gray-300"}`,children:m[n]===t.id?e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"}):e.jsx("span",{className:"text-xs font-medium text-gray-700",children:String.fromCharCode(65+t.orderIndex)})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium text-gray-800",children:t.text})})]})},t.id))}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(h,{onClick:J,disabled:n===0,variant:"outline",className:"flex items-center px-4 py-2 border-gray-300 text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ce,{size:16,className:"mr-1"}),"Previous"]}),e.jsx("div",{className:"flex space-x-3",children:n<s.questions.length-1?e.jsxs(h,{onClick:Z,disabled:!K(),className:`${Q.HIGHLIGHT_FRAME} px-6 py-2 flex items-center`,children:["Next",e.jsx(ae,{size:16,className:"ml-1"})]}):e.jsx(h,{onClick:$,disabled:!U()||w,className:`${Q.HIGHLIGHT_FRAME} px-6 py-2`,children:w?e.jsxs(e.Fragment,{children:[e.jsx(P,{size:16,className:"mr-2 animate-spin"}),"Submitting..."]}):"Complete Quiz"})})]})]})]})})})}function fe(){return e.jsx(me,{})}export{fe as default};
