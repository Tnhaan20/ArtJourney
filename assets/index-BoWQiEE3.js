import{z as f,m as Y,s as B,r as x,c as z,n as V,b as W,o as D,j as e,T as g,L as J}from"./index-LkxAMlZb.js";import{S as K}from"./SideBGSignIn-wkf99eEI.js";import{C as _}from"./Checkbox-CB5-casE.js";import{L as X}from"./LazyImg-4DrCpMtF.js";import{u as T}from"./use-survey-C3SIaMBG.js";const Z=f.object({surveyQuestionId:f.number().int("Survey question ID must be an integer").positive("Survey question ID must be positive"),surveyOptionId:f.number().int("Survey option ID must be an integer").positive("Survey option ID must be positive")}),q=f.object({answers:f.array(Z).min(1,"At least one answer is required").max(100,"Maximum 100 answers allowed")}),ee=()=>{const{createSurveySubmission:r}=T(),d=Y({resolver:B(q),defaultValues:{answers:[]}});return{form:d,onSubmit:async y=>{await r.mutateAsync(y),d.reset()},isLoading:r.isPending}};function se(){const[r,d]=x.useState(1),[l,y]=x.useState(0),[p,O]=x.useState({}),[R,H]=x.useState(5),w=z(),{toast:m}=V(),{getCurrentUser:M,login:te,updateSurveyStatus:C}=W(),{user:a}=M(),{getSurveyQuestionsQuery:k}=T(),{onSubmit:U,isLoading:v}=ee(),{data:j,isLoading:G,error:P}=k,N=(j==null?void 0:j.data)||[],c=N.length,u=N[l],h=(a==null?void 0:a.loginCount)===1;x.useEffect(()=>{const s=n=>{if(h&&!(a!=null&&a.isSurveyed)&&r<4)return n.preventDefault(),n.returnValue="",""},t=n=>{h&&!(a!=null&&a.isSurveyed)&&r<4&&(n.preventDefault(),window.history.pushState(null,"",window.location.pathname),m({title:"Survey Required",description:"Please complete the survey or skip it to continue using Art Journey.",variant:"destructive"}))};return h&&(window.addEventListener("beforeunload",s),window.addEventListener("popstate",t),!(a!=null&&a.isSurveyed)&&r<4&&window.history.pushState(null,"",window.location.pathname)),()=>{window.removeEventListener("beforeunload",s),window.removeEventListener("popstate",t)}},[a,r,m,h]),x.useEffect(()=>{if(r===4){D({particleCount:100,spread:70,origin:{y:.6}});const s=setInterval(()=>{H(t=>t<=1?(clearInterval(s),w("/"),0):t-1)},1e3);return()=>clearInterval(s)}},[r,w]);const E=()=>{r===1?d(2):r===2&&l<c-1?y(s=>s+1):r===2&&l===c-1&&d(3)},L=()=>{r===3?(d(2),y(c-1)):r===2&&l>0?y(s=>s-1):r===2&&l===0&&d(1)},S=()=>{a&&(C(!0),m({title:"Survey Skipped",description:"You can retake the survey anytime from your profile.",variant:"default"}),w("/"))},A=(s,t,n=!1)=>{O(i=>{if(n){const o=i[s]||[];return o.includes(t)?{...i,[s]:o.filter(b=>b!==t)}:{...i,[s]:[...o,t]}}else return{...i,[s]:[t]}})},$=async()=>{var s,t;if(!v)try{const n=Object.entries(p).flatMap(([i,o])=>o.map(b=>({surveyQuestionId:parseInt(i),surveyOptionId:parseInt(b)})));await U({answers:n}),C(!0),m({title:"Survey Completed!",description:"Thank you for completing the survey. Welcome to Art Journey!",variant:"success"}),d(4)}catch(n){console.error("Survey submission error:",n),n.name==="ZodError"?m({title:"Invalid Survey Data",description:"Please check your answers and try again.",variant:"destructive"}):m({title:"Submission Failed",description:((t=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to submit survey. Please try again.",variant:"destructive"})}},F=s=>{var t,n;return((t=s==null?void 0:s.surveyQuestionContent)==null?void 0:t.toLowerCase().includes("select all that apply"))||((n=s==null?void 0:s.surveyQuestionContent)==null?void 0:n.toLowerCase().includes("(select multiple)"))},I=()=>{let s=0;return r===1?s=0:r===2?c>0&&(s=(l+1)/c*90):r===3?s=95:r===4&&(s=100),e.jsxs("div",{className:"w-full mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:r===1?"Welcome":r===2?`Question ${l+1} of ${c}`:r===3?"Review Your Answers":"Complete"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[Math.round(s),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-primary-yellow h-2 rounded-full transition-all duration-300",style:{width:`${s}%`}})}),r===2&&e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsxs("span",{children:["Current: ",l+1]}),e.jsxs("span",{children:["Remaining: ",c-l-1]})]})]})},Q=Object.keys(p).filter(s=>{const t=p[s];return t&&t.length>0}).length;return G?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-yellow mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading survey questions..."})]})}):P?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600 mb-4",children:"Failed to load survey questions."}),e.jsx("button",{onClick:()=>k.refetch(),className:`${g.HIGHLIGHT_FRAME} px-6 py-2 rounded-md`,children:"Try Again"})]})}):e.jsxs("div",{className:"min-h-screen flex items-center justify-center",children:[h&&!(a!=null&&a.isSurveyed)&&e.jsx("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-amber-100 border border-amber-400 text-amber-700 px-4 py-2 rounded-lg shadow-lg z-50",children:e.jsx("p",{className:"text-sm font-medium",children:"Welcome! Please complete the survey to personalize your experience or skip it to continue."})}),r===1&&e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center",children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx(X,{loading:"lazy",src:K,alt:"Art Journey Welcome",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black opacity-60"})]}),e.jsxs("div",{className:"relative z-10 text-center p-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-primary-yellow mb-8",children:"WELCOME TO ART JOURNEY"}),e.jsx("p",{className:"text-white text-lg mb-8",children:"Let's personalize your art history learning experience"}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx("button",{onClick:E,className:`${g.HIGHLIGHT_FRAME} px-12 py-3 text-lg font-semibold rounded-md cursor-pointer`,children:"START SURVEY"}),e.jsx("button",{onClick:S,className:"px-12 py-3 text-lg font-semibold rounded-md border border-white text-white hover:bg-white hover:text-gray-800 transition-colors",children:"SKIP SURVEY"})]})]})]}),r===2&&u&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-4xl w-full mx-4",children:[e.jsx(I,{}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-6",children:u.surveyQuestionContent}),e.jsx("div",{className:"space-y-3",children:u.options.map(s=>{var i;const t=(i=p[u.surveyQuestionId])==null?void 0:i.includes(s.surveyOptionId),n=F(u);return e.jsx("div",{className:"flex items-center p-2",children:n?e.jsx(_,{checked:t,onChange:()=>A(u.surveyQuestionId,s.surveyOptionId,!0),color:"primary-yellow",children:e.jsx("span",{className:t?"text-primary-yellow":"text-gray-700",children:s.surveyOptionContent})}):e.jsxs("div",{className:`w-full p-4 border rounded-lg cursor-pointer flex items-center gap-4 ${t?"border-primary-yellow bg-amber-100":"border-gray-300 hover:border-amber-300"}`,onClick:()=>A(u.surveyQuestionId,s.surveyOptionId,!1),children:[e.jsx("div",{className:`w-4 h-4 rounded-full border-2 flex items-center justify-center ${t?"border-primary-yellow":"border-gray-300"}`,children:t&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary-yellow"})}),e.jsx("span",{className:t?"text-primary-yellow font-medium":"text-gray-700",children:s.surveyOptionContent})]})},s.surveyOptionId)})}),e.jsxs("div",{className:"mt-8 flex justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:L,className:"px-8 py-2 text-base font-semibold rounded-md border border-primary-yellow text-primary-yellow hover:bg-amber-50",children:"BACK"}),e.jsx("button",{onClick:S,className:"px-8 py-2 text-base font-semibold rounded-md border border-gray-300 text-gray-600 hover:bg-gray-50",children:"SKIP SURVEY"})]}),e.jsx("button",{onClick:E,className:`${g.HIGHLIGHT_FRAME} px-8 py-2 text-base font-semibold rounded-md`,children:l===c-1?"REVIEW":"NEXT"})]})]}),r===3&&e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-4xl w-full mx-4",children:[e.jsx(I,{}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Review Your Answers"}),e.jsx("div",{className:"space-y-6 max-h-96 overflow-y-auto",children:N.map(s=>{const t=p[s.surveyQuestionId]||[],n=s.options.filter(o=>t.includes(o.surveyOptionId)).map(o=>o.surveyOptionContent),i=t.length>0;return e.jsxs("div",{className:`border-b pb-4 ${i?"":"bg-gray-50 p-4 rounded-lg"}`,children:[e.jsx("h3",{className:"font-medium text-gray-800 mb-2",children:s.surveyQuestionContent}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i?n.map((o,b)=>e.jsx("span",{className:"px-3 py-1 bg-amber-100 text-amber-800 rounded-full text-sm",children:o},b)):e.jsx("span",{className:"text-gray-500 text-sm italic",children:"No answer selected"})})]},s.surveyQuestionId)})}),e.jsxs("div",{className:"mt-8 flex justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:L,className:"px-8 py-2 text-base font-semibold rounded-md border border-primary-yellow text-primary-yellow hover:bg-amber-50",children:"BACK TO QUESTIONS"}),e.jsx("button",{onClick:S,className:"px-8 py-2 text-base font-semibold rounded-md border border-gray-300 text-gray-600 hover:bg-gray-50",children:"SKIP SURVEY"})]}),e.jsx("button",{onClick:$,disabled:v||Q===0,className:`${g.HIGHLIGHT_FRAME} px-8 py-2 text-base font-semibold rounded-md ${v||Q===0?"opacity-50 cursor-not-allowed":""}`,children:v?"SUBMITTING...":"SUBMIT SURVEY"})]})]}),r===4&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-gradient-to-r from-amber-100 to-amber-200",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-10 max-w-4xl w-full mx-4 text-center relative overflow-hidden",children:[e.jsx(I,{}),e.jsx("div",{className:"absolute top-0 left-0 w-32 h-32 bg-primary-yellow opacity-10 rounded-full -translate-x-1/2 -translate-y-1/2"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-40 h-40 bg-primary-yellow opacity-10 rounded-full translate-x-1/2 translate-y-1/2"}),e.jsx("div",{className:"mx-auto w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mb-6",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-4",children:"Your Art Journey Begins Now!"}),e.jsx("p",{className:"text-lg text-gray-600 mb-6",children:"Thank you for completing the survey. We've personalized your experience based on your preferences."}),e.jsx("div",{className:"text-center mb-6",children:e.jsxs("p",{className:"text-gray-500",children:["Redirecting to homepage in"," ",e.jsx("span",{className:"text-primary-yellow font-bold",children:R})," ","seconds..."]})}),e.jsx(J,{to:"/",className:"inline-block px-8 py-3 bg-primary-yellow text-white rounded-md font-semibold hover:bg-amber-600 transition-colors",children:"Go to Homepage Now"})]})})]})}function oe(){return e.jsx(se,{})}export{oe as default};
