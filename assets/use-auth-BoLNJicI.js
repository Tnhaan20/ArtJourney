import{k as S,b as E,c as R,at as b,a3 as f,a2 as g,a4 as c,au as l,av as a,aw as u}from"./index-CdDrPE2n.js";const F=()=>{const{toast:s}=S(),{login:d}=E(),y=R(),m=b(),i=e=>y(e),w=f({mutationKey:[c.LOGIN],mutationFn:async e=>await l.post.login(e),onSuccess:async e=>{var o,n;const t=e==null?void 0:e.message;s({title:"Login success",description:t,variant:"success"});try{const r=(o=e==null?void 0:e.data)==null?void 0:o.userDTO;if(!r)throw new Error("User data not found in response");d(r);const h=(n=m.state)==null?void 0:n.from,p=a.getState().getRoleName(r.role);if(console.log("User role:",p),a.getState().hasRole(r,u.ADMIN)){i("/admin");return}else if(a.getState().hasRole(r,u.INSTRUCTOR)){i("/dashboard");return}else if(h){i(h);return}i("/")}catch(r){console.error("Authentication error:",r),s({title:"Authentication error",description:r.message||"There was a problem with your authentication",variant:"destructive"})}},onError:e=>{var o;let t="Invalid email, password or your account is not active";e.response?e.response.status===401?t="Invalid credentials. Please check your email and password.":e.response.status===403?t="Your account is not active or has been suspended.":(o=e.response.data)!=null&&o.message&&(t=e.response.data.message):e.request&&(t="Network error. Please check your connection and try again."),s({title:"Login failed",description:t,variant:"destructive"})}}),v=f({mutationKey:[c.REGISTER],mutationFn:async e=>{const{confirmPassword:t,...o}=e;return await l.post.register(o)},onSuccess:e=>{s({title:"Registration successful",description:"Your account has been created. Please sign in.",variant:"success"}),i("/signin")},onError:e=>{var t;s({title:"Registration failed",description:((t=e.response)==null?void 0:t.data)||"Something went wrong. Please try again.",variant:"destructive"})}});return{loginMutation:w,registerMutation:v,googleLogin:()=>({initiateGoogleLogin:()=>{try{const t=`${window.location.origin}/signin-google`,n=`https://zapz.phrimp.io.vn/api/Authentication/google-signin?redirect_uri=${encodeURIComponent(t)}&issignin=true`;window.location.href=n}catch{window.location.href="/signin"}}}),useGoogleCallback:()=>g({queryKey:[c.GOOGLE_CALLBACK],queryFn:async()=>await l.get.googleCallback(),enabled:!1,onSuccess:async e=>{try{const t=(e==null?void 0:e.message)||"Google login successful",o=e==null?void 0:e.data;if(!o)throw console.error("No user data found in response",e),new Error("User data not found in response");console.log("Setting user data in auth store:",o),d(o);const n=a.getState().getRoleName(o.role);console.log("User role:",n),a.getState().hasRole(o,u.ADMIN)||a.getState().hasRole(o,u.INSTRUCTOR)?i("/dashboard"):i("/")}catch(t){console.error("Authentication error:",t),s({title:"Authentication error",description:t.message||"There was a problem with your authentication",variant:"destructive"})}},onError:e=>{s({title:"Google login failed",description:e.message||"Failed to complete Google authentication",variant:"destructive"}),i("/signin")}}),useSendVerifyEmail:()=>g({queryKey:[c.VERIFY.SEND],queryFn:async()=>await l.get.sendVerifyEmail(),enabled:!1,onSuccess:e=>{s({title:"Verification email sent",description:(e==null?void 0:e.message)||"Please check your inbox.",variant:"success"})},onError:e=>{var t;s({title:"Failed to send verification email",description:((t=e.response)==null?void 0:t.data)||"Something went wrong. Please try again.",variant:"destructive"})}}),useVerifyEmail:(e,t={})=>g({queryKey:[c.VERIFY.GET,e],queryFn:async()=>{if(!e)throw new Error("No verification token provided");return await l.get.getVerifyEmail(e)},enabled:!!e&&t.enabled!==!1,retry:t.retry??0,refetchOnWindowFocus:t.refetchOnWindowFocus??!1,...t})}};export{F as u};
